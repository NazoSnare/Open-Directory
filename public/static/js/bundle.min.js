"use strict";var databutton={lastModified:function(){return databutton._lastModified},lastModifiedDate:function(){return databutton._lastModifiedDate},name:function(){return databutton._name},size:function(){return databutton._size},type:function(){return databutton._type},file:function(){return databutton._file},build:function(a){if(a.file){var u=a.button.$el instanceof Element?a.button.$el:document.querySelector(a.button.$el);(a.file.$el instanceof Element?a.file.$el:document.querySelector(a.file.$el)).onchange=function(t){t.target.files[0].type;for(var e in t.target.files[0])databutton["_"+e]=t.target.files[0][e];var n=new FileReader;n.addEventListener("load",function(t){var n=a.file.data;databutton._file=t.target.result,n.forEach(function(t,e){"function"==typeof t?n[e]=t():null===t&&(n[e]="")}),datapay.build({data:n},function(t,e){var n=e.outputs[0]._script.toASM();a.button.outputs=[{script:n,amount:0,currency:"BSV"}],a.button&&a.button.$pay&&a.button.$pay.to&&a.button.$pay.to.forEach(function(t){a.button.outputs.push({to:t.address,amount:t.value/1e8,currency:"BSV"})}),delete a.button.$el,delete a.button.$pay,moneyButton.render(u,a.button)})}),n.readAsArrayBuffer(t.target.files[0])}}else a.data&&datapay.build({data:a.data},function(t,e){var n=e.outputs[0]._script.toASM(),u=a.button.$el,o=a.button;o.outputs=[{script:n,amount:0,currency:"BSV"}],a.button&&a.button.$pay&&a.button.$pay.to&&a.button.$pay.to.forEach(function(t){o.outputs.push({to:t.address,amount:t.value,currency:t.currency})}),delete o.$el,delete o.$pay,moneyButton.render(u instanceof Element?u:document.querySelector(u),o)})}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}if(!SETTINGS){if("object"==("undefined"==typeof window?"undefined":_typeof(window)))throw"Error reading global settings...";var SETTINGS={api_key:"1D23Q8m3GgPFH15cwseLFZVVGSNg3ypP2z",api_endpoint:"https://bitomation.com/{api_action}/{api_key}/{query}",tip_addresses:[{address:"1LPe8CGxypahVkoBbYyoHMUAHuPb4S2JKL",name:"Open Directory",type:"opendirectory"}]}}function get_local_settings(){var t=window.localStorage.settings;if(t)try{return JSON.parse(t)}catch(t){}return{}}function save_local_settings(t){t?(window.localStorage.settings=JSON.stringify(t),console.log("Saving local settings",t)):delete window.localStorage.settings}function use_local_settings(t){if(t&&0<Object.keys(t).length)for(var o in console.log("Found local settings",t),t){var e=t[o];console.log("Local setting override",o,e),SETTINGS[o]=e}}function get_root_category_txid(){return SETTINGS.category?SETTINGS.category:null}var BSV_PRICE=53;"object"==("undefined"==typeof window?"undefined":_typeof(window))?use_local_settings(get_local_settings()):module.exports=SETTINGS;
"use strict";function satoshisToDollars(i){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:BSV_PRICE,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(0<i){var r=(i/1e8*t).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});return"0.00"!=r&&"0.01"!=r||5==(r=(i/1e8*t).toLocaleString(void 0,{minimumFractionDigits:3,maximumFractionDigits:3})).length&&"0"==r[4]&&(r=r.slice(0,4)),"$"+r}if(n)return"$0.00"}function numberFormat(i){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3;if(0<i){var n=i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:t});return".00"==n.slice(-3)?n.slice(0,-3):n}return"0"}function timeDifference(i,t){if(!i||!t)return"just now";var n=36e5,r=24*n,e=30*r,o=365*r,a=i-t;return a<6e4?pluralize(Math.round(a/1e3),"second","seconds")+" ago":a<n?pluralize(Math.round(a/6e4),"minute","minutes")+" ago":a<r?pluralize(Math.round(a/n),"hour","hours")+" ago":a<e?pluralize(Math.round(a/r),"day","days")+" ago":a<o?pluralize(Math.round(a/e),"month","months")+" ago":pluralize(Math.round(a/o),"year","years")+" ago"}function pluralize(i,t,n){return 1==i?i+" "+t:i+" "+n}function isBottle(){return-1!==navigator.userAgent.indexOf("Bottle")}function getBitLinkForBMediaTXID(i){return"bit://"+B_MEDIA_PROTOCOL+"/"+i}function getBMediaURLForTXID(i){return isBottle()?i:"https://bico.media/"+i}function getTXIDFromURL(i){}
"use strict";function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var isNode="undefined"==typeof window;isNode&&(axios=require("axios"),SETTINGS=require("./settings.js"));var B_MEDIA_PROTOCOL="19HxigV4QyBv3tHpQVcUEQyq1pzZVdoAut",BCAT_MEDIA_PROTOCOL="15DHFxWZJT58f9nhyGnsRBqrgwK4W6h4Up",SUPPORTED_TIPCHAIN_PROTOCOLS=["bit://"+B_MEDIA_PROTOCOL+"/","b://","bit://"+BCAT_MEDIA_PROTOCOL+"/"],OPENDIR_PROTOCOL="1dirzgocAsru3SdhetQkEJraQgYTf5xQm",OPENDIR_ACTIONS=["category.create","category.update","category.delete","entry.create","entry.update","entry.delete","vote","undo","fork.soft"];function toBase64(t){return isNode?Buffer.from(t).toString("base64"):btoa(t)}function get_bmedia_bitdb_query(t){return{v:3,q:{db:["u","c"],limit:2<arguments.length&&void 0!==arguments[2]?arguments[2]:500,sort:{txid:1},aggregate:[{$match:{"tx.h":{$in:t}}},{$skip:1<arguments.length&&void 0!==arguments[1]?arguments[1]:0}]},r:{f:'[.[] | {                                  "height": .blk.i?,                        "time": .blk.t?,                        "address": .in[0].e.a,                    "outputs": [.out[] | {"address": .e.a, "sats": .e.v}],                 "txid": .tx.h,                            "data": .out[0] | with_entries(select(((.key | startswith("s")) and (.key != "str"))))}]'}}}function get_bitdb_query(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:500,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:5;null==t&&(t=get_root_category_txid());var o={v:3,q:{db:["u","c"],limit:r,sort:{txid:1},aggregate:[{$match:{$and:[{"out.s1":OPENDIR_PROTOCOL}]}},{$graphLookup:{from:"c",startWith:"$tx.h",connectFromField:"tx.h",connectToField:"out.s3",as:"confirmed_children",maxDepth:n}},{$project:{confirmed_children:"$confirmed_children",object:["$$ROOT"]}},{$project:{"object.confirmed_children":0}},{$project:{items:{$concatArrays:["$object","$confirmed_children"]}}},{$unwind:{path:"$items",preserveNullAndEmptyArrays:!0}},{$replaceRoot:{newRoot:"$items"}},{$graphLookup:{from:"u",startWith:"$tx.h",connectFromField:"tx.h",connectToField:"out.s3",as:"unconfirmed_children",maxDepth:n}},{$project:{unconfirmed_children:"$unconfirmed_children",object:["$$ROOT"]}},{$project:{"object.unconfirmed_children":0}},{$project:{items:{$concatArrays:["$object","$unconfirmed_children"]}}},{$unwind:{path:"$items",preserveNullAndEmptyArrays:!0}},{$replaceRoot:{newRoot:"$items"}},{$graphLookup:{from:"c",startWith:"$out.s3",connectFromField:"out.s3",connectToField:"tx.h",as:"confirmed_parent"}},{$project:{confirmed_parent:"$confirmed_parent",object:["$$ROOT"]}},{$project:{"object.confirmed_parent":0}},{$project:{items:{$concatArrays:["$object","$confirmed_parent"]}}},{$unwind:{path:"$items",preserveNullAndEmptyArrays:!0}},{$replaceRoot:{newRoot:"$items"}},{$graphLookup:{from:"u",startWith:"$out.s3",connectFromField:"out.s3",connectToField:"tx.h",as:"unconfirmed_parent"}},{$project:{unconfirmed_parent:"$unconfirmed_parent",object:["$$ROOT"]}},{$project:{"object.unconfirmed_parent":0}},{$project:{items:{$concatArrays:["$object","$unconfirmed_parent"]}}},{$unwind:{path:"$items",preserveNullAndEmptyArrays:!0}},{$replaceRoot:{newRoot:"$items"}},{$addFields:{b_txid:[{txid:{$arrayElemAt:[{$split:[{$arrayElemAt:["$out.s7",0]},"bit://"+B_MEDIA_PROTOCOL+"/"]},1]}},{txid:{$arrayElemAt:[{$split:[{$arrayElemAt:["$out.s7",0]},"b://"]},1]}},{txid:{$arrayElemAt:[{$split:[{$arrayElemAt:["$out.s7",0]},"bit://"+BCAT_MEDIA_PROTOCOL+"/"]},1]}},{txid:{$arrayElemAt:[{$split:[{$arrayElemAt:["$out.s7",0]},"bcat://"]},1]}}]}},{$lookup:{from:"c",localField:"b_txid.txid",foreignField:"tx.h",as:"confirmed_bmediatx"}},{$project:{confirmed_bmediatx:"$confirmed_bmediatx",object:["$$ROOT"]}},{$project:{"object.confirmed_bmediatx":0,"object.b_txid":0}},{$project:{"confirmed_bmediatx.tx":1,"confirmed_bmediatx.blk":1,"confirmed_bmediatx.in":1,"confirmed_bmediatx.out.s1":1,"confirmed_bmediatx.out.e":1,object:1}},{$project:{items:{$concatArrays:["$object","$confirmed_bmediatx"]}}},{$unwind:{path:"$items",preserveNullAndEmptyArrays:!0}},{$replaceRoot:{newRoot:"$items"}},{$lookup:{from:"u",localField:"b_txid.txid",foreignField:"tx.h",as:"unconfirmed_bmediatx"}},{$project:{unconfirmed_bmediatx:"$unconfirmed_bmediatx",object:["$$ROOT"]}},{$project:{"object.unconfirmed_bmediatx":0,"object.b_txid":0}},{$project:{"unconfirmed_bmediatx.tx":1,"unconfirmed_bmediatx.blk":1,"unconfirmed_bmediatx.in":1,"unconfirmed_bmediatx.out.s1":1,"unconfirmed_bmediatx.out.e":1,object:1}},{$project:{items:{$concatArrays:["$object","$unconfirmed_bmediatx"]}}},{$unwind:{path:"$items",preserveNullAndEmptyArrays:!0}},{$replaceRoot:{newRoot:"$items"}},{$project:{_id:0}},{$addFields:{_id:"$tx.h"}},{$group:{_id:null,items:{$addToSet:"$$ROOT"}}},{$unwind:{path:"$items"}},{$replaceRoot:{newRoot:"$items"}},{$skip:e}]},r:{f:'[.[] | {                                  "height": .blk.i?,                        "time": .blk.t?,                        "address": .in[0].e.a,                    "outputs": [.out[] | {"address": .e.a, "sats": .e.v}],                 "txid": .tx.h,                            "data": .out[0] | with_entries(select(((.key | startswith("s")) and (.key != "str"))))}]'}};return t?o.q.aggregate[0].$match.$and.push({$or:[{"tx.h":t},{"out.s3":t}]}):o.q.aggregate[0].$match.$and.push({$or:[{$and:[{"out.s2":"fork.soft"},{"out.s4":null}]},{$and:[{"out.s2":"category.create"},{"out.s3":"name"}]}]}),o}function fetch_from_network(){var y=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,p=2<arguments.length&&void 0!==arguments[2]?arguments[2]:500,v=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];null==y&&(y=get_root_category_txid());var t=get_bitdb_query(y,h,p),e=toBase64(JSON.stringify(t)),n=SETTINGS.api_endpoint.replace("{api_key}",SETTINGS.api_key).replace("{api_action}","q").replace("{query}",e),o={headers:{key:SETTINGS.api_key}};function i(t,e,r){if(r.errors)e("error during query "+r.errors);else{var n={},o=r.c.concat(r.u).reverse();if(v=v.concat(o),h+=o.length,o.length>=p)console.log("Seems like there's still more... polling for more"),fetch_from_network(y,h,p,v).then(t).catch(e);else{var i=v.sort(function(t,e){return(null===t.height)-(null===e.height)||+(t.height>e.height)||-(t.height<e.height)}),a=(n=new Map,!0),c=!1,l=void 0;try{for(var s,u=i[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var d=s.value,f=n[d.txid];f&&(!f||f.height)||n.set(d.txid,d)}}catch(t){c=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(c)throw l}}t(Array.from(n.values()))}}}return new Promise(function(e,r){console.log("Making HTTP request to server "+h+","+p),isNode?(axios=require("axios"),axios(n,o).then(function(t){200===t.status?i(e,r,t.data):r("Error while retrieving response from server "+t.status)}).catch(r)):fetch(n,o).then(function(t){if(200===t.status)return t.json();r("Error while retrieving response from server "+t.status)}).then(function(t){i(e,r,t)}).catch(r)})}function fetch_bmedia_from_network(_){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,$=2<arguments.length&&void 0!==arguments[2]?arguments[2]:500,x=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],t=get_bmedia_bitdb_query(_,b,$),n="https://genesis.bitdb.network/q/1FnauZ9aUH2Bex6JzdcV4eNX7oLSSEbxtN/"+btoa(JSON.stringify(t)),o={headers:{key:"1A4xFjNatCgAK5URARbVwoxo1E3MCMETb6"}};return new Promise(function(e,r){console.log("Making HTTP request to server "+b+","+$),fetch(n,o).then(function(t){if(200===t.status)return t.json();r("Error while retrieving response from server "+t.status)}).then(function(t){!function(t,e,r){if(r.errors)e("error during query "+r.errors);else{var n={},o=r.c.concat(r.u).reverse(),i=!0,a=!1,c=void 0;try{for(var l,s=o[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value;console.log("ROW",u)}}catch(t){a=!0,c=t}finally{try{i||null==s.return||s.return()}finally{if(a)throw c}}if(x=x.concat(o),b+=o.length,o.length>=$)console.log("Seems like there's still more... polling for more"),fetch_bmedia_from_network(_,b,$,x).then(t).catch(e);else{var d=x.sort(function(t,e){return(null===t.height)-(null===e.height)||+(t.height>e.height)||-(t.height<e.height)}),f=(n=new Map,!0),y=!1,h=void 0;try{for(var p,v=d[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var m=p.value,g=n[m.txid];g&&(!g||g.height)||n.set(m.txid,m)}}catch(t){y=!0,h=t}finally{try{f||null==v.return||v.return()}finally{if(y)throw h}}t(Array.from(n.values()))}}}(e,r,t)}).catch(r)})}function processOpenDirectoryTransactions(t){return t.map(processOpenDirectoryTransaction).filter(function(t){return t})}function findChildrenByActionID(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value;if(l.action_id==t.txid){var s=findChildrenByActionID(l,e);r=r.concat([l],s)}}}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}function processUndos(t){var e={},r=!0,n=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;e[c.txid]=c}}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}var l=[],s=!0,u=!1,d=void 0;try{for(var f,y=t[Symbol.iterator]();!(s=(f=y.next()).done);s=!0){var h=f.value;e[h.action_id]||l.push(h)}}catch(t){u=!0,d=t}finally{try{s||null==y.return||y.return()}finally{if(u)throw d}}for(var p=new Set,v=0,m=l;v<m.length;v++){for(var g=findChildrenByActionID(m[v],t),_={},b=g.length-1;0<=b;b--){var $=g[b];"undo"===$.type&&(_[$.txid]||(_[$.action_id]=$))}for(var x in _)p.add(x)}return Array.from(p)}function processRawResults(t){return processResults(t,processOpenDirectoryTransactions(t))}function processResults(e,t){var r=[],n=processUndos(t);function o(t){return processResult(t,r,n,e)}var i=!0,a=!1,c=void 0;try{for(var l,s=t.filter(function(t){return"category"==t.type&&"create"==t.action})[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value;r=o(u)}}catch(t){a=!0,c=t}finally{try{i||null==s.return||s.return()}finally{if(a)throw c}}var d=!0,f=!1,y=void 0;try{for(var h,p=t.filter(function(t){return"category"==t.type&&"update"==t.action})[Symbol.iterator]();!(d=(h=p.next()).done);d=!0){var v=h.value;r=o(v)}}catch(t){f=!0,y=t}finally{try{d||null==p.return||p.return()}finally{if(f)throw y}}var m=!0,g=!1,_=void 0;try{for(var b,$=t.filter(function(t){return"category"==t.type&&"delete"==t.action})[Symbol.iterator]();!(m=(b=$.next()).done);m=!0){var x=b.value;r=o(x)}}catch(t){g=!0,_=t}finally{try{m||null==$.return||$.return()}finally{if(g)throw _}}var O=!0,T=!1,w=void 0;try{for(var R,j=t.filter(function(t){return"entry"==t.type&&"create"==t.action})[Symbol.iterator]();!(O=(R=j.next()).done);O=!0){var S=R.value;r=o(S)}}catch(t){T=!0,w=t}finally{try{O||null==j.return||j.return()}finally{if(T)throw w}}var E=!0,A=!1,k=void 0;try{for(var P,N=t.filter(function(t){return"entry"==t.type&&"update"==t.action})[Symbol.iterator]();!(E=(P=N.next()).done);E=!0){var C=P.value;r=o(C)}}catch(t){A=!0,k=t}finally{try{E||null==N.return||N.return()}finally{if(A)throw k}}var I=!0,D=!1,F=void 0;try{for(var B,M=t.filter(function(t){return"entry"==t.type&&"delete"==t.action})[Symbol.iterator]();!(I=(B=M.next()).done);I=!0){var q=B.value;r=o(q)}}catch(t){D=!0,F=t}finally{try{I||null==M.return||M.return()}finally{if(D)throw F}}r=processTipchain(r,t);var L=!0,U=!1,H=void 0;try{for(var V,X=t.filter(function(t){return"vote"==t.type})[Symbol.iterator]();!(L=(V=X.next()).done);L=!0){var J=V.value;r=o(J)}}catch(t){U=!0,H=t}finally{try{L||null==X.return||X.return()}finally{if(U)throw H}}var G=!0,K=!1,W=void 0;try{for(var Q,z=t.filter(function(t){return"fork"==t.type})[Symbol.iterator]();!(G=(Q=z.next()).done);G=!0){var Z=Q.value;r=o(Z)}}catch(t){K=!0,W=t}finally{try{G||null==z.return||z.return()}finally{if(K)throw W}}for(var Y=0,tt=[updateCategoryEntryCounts,updateCategoryMoneyCounts,updateEntryHottness];Y<tt.length;Y++){r=(0,tt[Y])(r)}return r}function updateEntryHottness(t){return t.map(function(t){return t.hottness=calculateEntryHottness(t),t})}function calculateEntryHottness(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1.8,r=1*(t.satoshis+t.votes),n=(new Date).getTime()/1e3,o=(t.time?n-t.time:0)/3600;return r/Math.pow(2+o,e)}function processTipchainResult(t,e,r,n){var o=JSON.parse(JSON.stringify(SETTINGS.tip_addresses)),i={address:t.address,txid:t.txid,type:t.type},a=o.concat(i);if(t.category){var c=findObjectByTX(t.category,e);c&&(processTipchainResult(c,e,r,n),a=c.tipchain.concat([i]))}if("entry"==t.type){var l=parseTipFromEntryMedia(t,n);l&&a.push(l)}var s=(t.tipchain=a).map(function(t){return t.address}),u=convertOutputs(t.outputs,s);t.satoshis=u}function processTipchain(t,e){var r={},n=!0,o=!1,i=void 0;try{for(var a,c=e.filter(function(t){return"other"==t.type})[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value;r[l.txid]=l}}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}var s=!0,u=!1,d=void 0;try{for(var f,y=t[Symbol.iterator]();!(s=(f=y.next()).done);s=!0){var h=f.value;"entry"!==h.type&&"category"!==h.type||processTipchainResult(h,t,e,r)}}catch(t){u=!0,d=t}finally{try{s||null==y.return||y.return()}finally{if(u)throw d}}return t}function processCategoryResult(t,e,r,n){if(-1!==r.indexOf(t.txid))return e;if("create"==t.action){var o=t.change;t.action_id&&(o.category=t.action_id),o.type=t.type,o.txid=t.txid,o.address=t.address,o.height=t.height,o.time=t.time,o.outputs=t.outputs,o.votes=0,o.entries=0,e.push(o)}else if("update"==t.action){var i=findObjectByTX(t.action_id,e);if(i)for(var a in t.change)i[a]=t.change[a];else console.log("couldn't find category for update",i,t,e)}else if("delete"==t.action){var c=findObjectByTX(t.action_id,e);c?c.deleted=!0:console.log("couldn't find object for delete",c,t)}else console.log("error processing category",t);return e}function processEntryResult(t,e,r,n){if(-1!==r.indexOf(t.txid))return e;if("create"==t.action){var o=t.change;t.action_id&&(o.category=t.action_id),o.type=t.type,o.txid=t.txid,o.address=t.address,o.height=t.height,o.time=t.time,o.outputs=t.outputs,o.hottness=0,o.votes=0,e.push(o)}else if("update"==t.action){var i=findObjectByTX(t.action_id,e);if(i)for(var a in t.change)i[a]=t.change[a];else console.log("couldn't find category for update",i,t,e)}else if("delete"==t.action){var c=findObjectByTX(t.action_id,e);c?c.deleted=!0:console.log("couldn't find object for delete",c,t)}else console.log("error processing entry",t);return e}function processVoteResult(t,e,r,n){var o=findObjectByTX(t.action_id,e);if(o){var i=o.tipchain.map(function(t){return t.address}),a=convertOutputs(t.outputs,i);if(-1==r.indexOf(t.txid)&&(o.votes+=1,o.satoshis+=a),0<a)for(var c in n)n[c].txid==t.txid&&(n[c].satoshis=a)}else console.log("couldn't find object for vote",o,t);return e}function processForkResult(t,e,r){var n=[];if(t.action_id){var o=findObjectByTX(t.action_id,e);o&&(n=o.tipchain.map(function(t){return t.address}))}else n=SETTINGS.tip_address;var i=convertOutputs(t.outputs,n);if(t.satoshis?t.satoshis+=i:t.satoshis=i,0<i)for(var a in r)r[a].txid==t.txid&&(r[a].satoshis=i);return e}function processResult(t,e,r,n){switch(t.type){case"category":return processCategoryResult(t,e,r,n);case"entry":return processEntryResult(t,e,r,n);case"vote":return processVoteResult(t,e,r,n);case"fork":return processForkResult(t,e,n);default:return console.log("error processing result",t),e}}function parseTransactionAddressFromURL(t){for(var e=0,r=SUPPORTED_TIPCHAIN_PROTOCOLS;e<r.length;e++){var n=r[e],o=t.split(n);if(2==o.length){var i=o[1];if(64==i.length)return i}}return null}function parseTipFromEntryMedia(t,e){for(var r=0,n=SUPPORTED_TIPCHAIN_PROTOCOLS;r<n.length;r++){var o=n[r],i=t.link.split(o);if(2==i.length){var a=i[1];if(64==a.length){var c=e[a];if(c)return{address:c.address,type:"media"};console.log("unable to find associated b media for item",t.txid)}}}return null}function updateCategoryMoneyCounts(e){return e.map(function(t){return"category"==t.type&&(t.satoshis=countMoneyUnderObject(t,e)),t})}function countMoneyUnderObject(t,e){var r=t.satoshis,n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value;l.deleted||l.category!=t.txid||(r+=l.satoshis,"category"==l.type&&(r+=countMoneyUnderObject(l,e)))}}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}function updateCategoryEntryCounts(e){return e.map(function(t){return"category"==t.type&&(t.entries=countObjectsUnderObject(t,e)),t})}function countObjectsUnderObject(t,e){var r=0,n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value;l.deleted||l.category!=t.txid||(r+=1,"category"==l.type&&(r+=countObjectsUnderObject(l,e)))}}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}function expandTipchainInformation(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],n=t.slice(0).reverse(),o=n.map(function(t){return t.address}),i=calculateTipchainSplits(n).reverse(),a=[],c=0;c<o.length;c++){var l=n[c],s=l.name;if(!s&&l.txid){var u=findObjectByTX(l.txid,r);u&&(s=u.name)}s||(s="");var d=i[c],f=e*d;a.push({address:l.address,type:l.type,split:d,amount:f,name:s})}return a}function convertKeyValues(t){for(var e=JSON.parse(JSON.stringify(t)),r={},n=null,o=null,i=null;i=e.shift();)n?o=i:n=i,n&&o&&(r[n]=o,o=n=null);return r}function calculateTipchainSplits(t){if(0==t.length)return[];for(var e=[],r=1;r<=t.length;r++)e.push(1+Math.log(r));var n=e.reduce(function(t,e){return t+e});return e.map(function(t){return t/n})}function calculateTipPayment(t,e,r){if(!e)return console.log("error while calculating tip payment, invalid amount"),null;if(!r)return console.log("error while calculating tip payment, invalid currency"),null;var n=calculateTipchainSplits(t);if(n.length!=t.length)return console.log("error while calculating tip payment, weights didn't match tipchain length"),null;for(var o=[],i=0;i<t.length;i++){var a="object"==_typeof(t[i])?t[i].address:t[i],c=n[i],l=Math.round(c*e*1e4)/1e4;0<l&&o.push({address:a,value:l,currency:r})}return o}function processOpenDirectoryTransaction(t){var e;if(!t.txid||!t.data||!t.address)return null;var r,n,o=t.txid,i=t.address,a=t.height?t.height:Math.Infinity,c=t.time?t.time:0,l=t.outputs?t.outputs:[],s=Object.values(t.data),u=s.shift(),d=s.shift();if(!o)return console.log("Error while processing open directory transaction: no txid",t),null;if(u!==OPENDIR_PROTOCOL)return{txid:t.txid,address:t.address,height:a,time:c,type:"other"};if(-1==OPENDIR_ACTIONS.indexOf(d))return console.log("Error while processing open directory transaction: invalid action",t),null;if("vote"==d||"undo"==d)r=n=d;else{var f=d.split(".");if(2!=f.length)return console.log("Error while processing open directory transaction: invalid action",t),null;r=f[0],n=f[1]}var y=(_defineProperty(e={type:r},"type",r),_defineProperty(e,"action",n),_defineProperty(e,"txid",o),_defineProperty(e,"address",i),_defineProperty(e,"height",a),_defineProperty(e,"time",c),_defineProperty(e,"outputs",l),e);if("category"==r)if("create"==n)s.length%2==1&&(y.action_id=s.shift()),y.change=convertKeyValues(s);else if("update"==n)y.action_id=s.shift(),y.change=convertKeyValues(s);else if("delete"==n){y.action_id=s.shift();var h=s.shift();h&&(y.description=h,t.description=h)}else console.log("unknown category action",t);else if("entry"==r)if("create"==n)y.action_id=s.shift(),y.change=convertKeyValues(s);else if("update"==n)y.action_id=s.shift(),y.change=convertKeyValues(s);else if("delete"==n){y.action_id=s.shift();var p=s.shift();p&&(y.description=p,t.description=p)}else console.log("unknown entry action",t);else"vote"==r?y.action_id=s.shift():"fork"==r?1==s.length?y.fork_url=s.shift():2==s.length?(y.action_id=s.shift(),y.fork_url=s.shift()):console.log("unknown number of args",t):"undo"==r?(1==s.length?(y.reference_id=s.shift(),y.action_id=y.reference_id):2==s.length?(y.reference_id=s.shift(),y.action_id=s.shift()):(y.reference_id=s.shift(),y.action_id=s.shift(),y.description=s.shift()),y.reference_id&&(t.reference_id=y.reference_id),y.action_id&&(t.action_id=y.action_id),y.description&&(t.description=y.description)):console.log("unknown item type",t);return y}function convertOutputs(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=0,n=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value;-1!==e.indexOf(l.address)&&(r+=l.sats)}}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}function findObjectByTX(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=!0,n=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;if(c.txid==t)return c}}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return null}function findRootActionID(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(!t.action_id)return null;if("undo"==t.type&&t.action_id){var r=findObjectByTX(t.action_id,e);if(r&&"undo"==r.type){var n=findRootActionID(r,e);if(n)return n}}return t.action_id}"undefined"==typeof window&&(module.exports={OPENDIR_PROTOCOL:OPENDIR_PROTOCOL,OPENDIR_ACTIONS:OPENDIR_ACTIONS,fetch_from_network:fetch_from_network,processResults:processResults,processRawResults:processRawResults,calculateTipchainSplits:calculateTipchainSplits,calculateTipPayment:calculateTipPayment});
"use strict";function updateBitcoinSVPrice(){var e=window.localStorage,r=e.bsv_price_cache;if(r)try{var i=JSON.parse(r),t=i.price,o=i.date;if(t&&o){var n=(new Date).getTime();if(BSV_PRICE=t,n-o<432e5)return void console.log("Using cached Bitcoin SV price of",t);console.log("Bitcoin SV price cache is old....updating")}}catch(r){console.log("Error parsing Bitcoin SV price cache",r)}getLatestBitcoinSVPrice().then(function(r){0<r&&(console.log("Updating BSV price from",BSV_PRICE,"to",r),BSV_PRICE=r,e.bsv_price_cache=JSON.stringify({price:r,date:(new Date).getTime()}))}).catch(function(r){console.log("Error while fetching BSV price",r)})}function getLatestBitcoinSVPrice(){return new Promise(function(e,i){getBitcoinSVPriceFromCoinGecko().then(e).catch(function(r){console.log("Error while fetching BSV price",r),getBitcoinSVPriceFromCryptonator().then(e).catch(function(r){console.log("Error while fetching BSV price",r),getBitcoinSVPriceFromCoinMarketCap().then(e).catch(i)})})})}function getBitcoinSVPriceFromCoinMarketCap(){return new Promise(function(a,p){fetch("https://cors-anywhere.herokuapp.com/https://api.coinmarketcap.com/v1/ticker/bitcoin-sv/").then(function(r){if(200===r.status)return r.json();p("Error while retrieving response from CoinMarketCap server "+r.status)}).then(function(r){var e=!0,i=!1,t=void 0;try{for(var o,n=r[Symbol.iterator]();!(e=(o=n.next()).done);e=!0){var c=o.value;if("bitcoin-sv"==c.id){var s=Number(c.price_usd);if(0<s)return void a(s)}}}catch(r){i=!0,t=r}finally{try{e||null==n.return||n.return()}finally{if(i)throw t}}p("Error while parsing response from CoinMarketCap price API")}).catch(p)})}function getBitcoinSVPriceFromCryptonator(){return new Promise(function(i,t){fetch("https://cors.io/?https://api.cryptonator.com/api/ticker/bsv-usd").then(function(r){if(200===r.status)return r.json();t("Error while retrieving response from Cryptonator server "+r.status)}).then(function(r){if(r.ticker&&r.ticker.price){var e=Number(r.ticker.price);if(0<e)return void i(e)}t("Error while parsing response from Crytponator price API")}).catch(t)})}function getBitcoinSVPriceFromCoinGecko(){var o="bitcoin-cash-sv";return new Promise(function(i,t){fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin-cash-sv&vs_currencies=USD").then(function(r){if(200===r.status)return r.json();t("Error while retrieving response from CoinGecko server "+r.status)}).then(function(r){if(r[o]&&r[o].usd){var e=Number(r[o].usd);if(0<e)return void i(e)}t("Error while parsing response from coingecko price API")}).catch(t)})}
"use strict";var ALLOWED_ACTIONS=["uri","attach","detach"];function fetchAdminActions(t){var e={v:3,sort:{txid:1},q:{find:{"out.s1":t,"in.e.a":t},limit:9999},r:{f:'[.[] | {                                  "height": .blk.i?,                        "time": .blk.t?,                        "address": .in[0].e.a,                    "txid": .tx.h,                            "data": .out[0] | with_entries(select(((.key | startswith("s")) and (.key != "str"))))}]'}},n=toBase64(JSON.stringify(e)),i=SETTINGS.api_endpoint.replace("{api_key}",SETTINGS.api_key).replace("{api_action}","q").replace("{query}",n),c={headers:{key:SETTINGS.api_key}};return new Promise(function(n,e){t?(console.log("Fetching admin actions for admin protocol",t),fetch(i,c).then(function(t){t?200!==t.status?e("Error response status code while checking updater "+t.status):t.json().then(function(t){var e=t.c.concat(t.u).sort(function(t,e){return(null===t.height)-(null===e.height)||+(t.height>e.height)||-(t.height<e.height)});n(e)}):e("Error response while checking updater")})):e("invalid admin address")})}function getCachedAdminActions(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:60;return new Promise(function(e,t){(new Date).getTime();var n="admin_actions_"+SETTINGS.admin_address,i=lscache.get(n);if(i)return e(i);fetchAdminActions(SETTINGS.admin_address).then(function(t){t&&lscache.set(n,t,c),e(t)}).catch(t)})}function processAdminResult(t){var e=t.data.s2;if(-1==ALLOWED_ACTIONS.indexOf(e))return null;var n={type:"admin",height:t.height,address:t.address,txid:t.txid,time:t.time,action:e,data:t.data};if("uri"==e){var i=t.data.s3;n.uri=i}else"attach"!=e&&"detach"!=e||(n.action_id=t.data.s3);return n}function processAdminResults(t){return t.map(processAdminResult).filter(function(t){return t})}function fetchLog(){return new Promise(function(e,t){getCachedAdminActions().then(function(t){e(processAdminResults(t))}).catch(t)})}function fetchURIs(){return new Promise(function(n,t){getCachedAdminActions().then(function(t){var e=processAdminResults(t).filter(function(t){return"uri"==t.action});n(e)}).catch(t)})}function fetchAttachAndDetaches(){return new Promise(function(n,t){getCachedAdminActions().then(function(t){var e=processAdminResults(t).filter(function(t){return"attach"==t.action||"detach"==t.action});n(e)}).catch(t)})}function getLatestUpdate(){return new Promise(function(e,t){return fetchURIs().then(function(t){t&&0<t.length&&e(t[t.length-1])})})}
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var SearchPage=function(){function r(e){var t;return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e))).state={search:""},t}return _inherits(r,React.Component),_createClass(r,[{key:"handleSearch",value:function(e){this.setState({search:e.target.value})}},{key:"render",value:function(){return React.createElement("div",{className:"search"},React.createElement(SearchForm,{search:this.state.search,title:this.props.title,onSearch:this.handleSearch.bind(this),category:this.props.category}),this.state.search&&React.createElement(SearchResults,{search:this.state.search,items:this.props.items}))}}]),r}(),SearchForm=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,React.Component),_createClass(e,[{key:"handleSubmit",value:function(e){e.preventDefault()}},{key:"render",value:function(){var e;return this.props.category&&this.props.category.name?e=React.createElement("span",null,"Search ",React.createElement("a",{href:"#"+this.props.category.txid},this.props.category.name)):this.props.category&&this.props.category.txid?e=React.createElement("span",null,"Search category ",this.props.category.txid.slice(0,5),"..."):this.props.category&&!this.props.category.txid&&(e=React.createElement("span",null,"Search ",React.createElement("a",{href:"#"},"Open Directory"))),React.createElement("div",{className:"search"},React.createElement("h2",null,e),React.createElement("p",{className:"blurb"},"Search by name, description, link, txid, address..."),React.createElement("form",{onSubmit:this.handleSubmit.bind(this)},React.createElement("input",{type:"search",value:this.props.search,onChange:this.props.onSearch.bind(this)}),React.createElement("input",{type:"submit",className:"button-outline",value:"Search"})))}}]),e}(),SearchResults=function(){function r(e){var t;return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e))).state={limit:15,cursor:0},t}return _inherits(r,React.Component),_createClass(r,[{key:"handlePageChange",value:function(e){var t=(e-1)*this.state.limit;this.setState({cursor:t}),window.scrollTo(0,250)}},{key:"render",value:function(){var r=this,o=this.props.search.toLowerCase(),e=this.props.items.filter(function(e){if(-1!==e.name.toLowerCase().indexOf(o))return!0;if(-1!==e.description.toLowerCase().indexOf(o))return!0;if(-1!==e.txid.toLowerCase().indexOf(o))return!0;if(-1!==e.address.toLowerCase().indexOf(o))return!0;if(e.link&&-1!==e.link.toLowerCase().indexOf(o))return!0;var t=!0,r=!1,a=void 0;try{for(var s,n=e.tipchain[Symbol.iterator]();!(t=(s=n.next()).done);t=!0){if(-1!==s.value.address.toLowerCase().indexOf(o))return!0}}catch(e){r=!0,a=e}finally{try{t||null==n.return||n.return()}finally{if(r)throw a}}return!1}),t=e.sort(function(e,t){return e.hottness<t.hottness?1:e.hottness>t.hottness?-1:e.satoshis<t.satoshis?1:e.satoshis>t.satoshis?-1:e.votes<t.votes?1:e.votes>t.votes?-1:e.height<t.height?1:e.height>t.height?-1:0}).slice(this.state.cursor,this.state.cursor+this.state.limit),a=Math.ceil(e.length/this.state.limit),s=_toConsumableArray(Array(a).keys()).map(function(e){var t=e+1;return React.createElement("a",{key:"page-"+t,className:r.state.cursor==e*r.state.limit?"active":null,onClick:function(){r.handlePageChange(t)}},t)});return React.createElement("div",null,React.createElement("ul",{className:"search-results"},t.map(function(e){return React.createElement(SearchResult,{key:e.txid,item:e})})),React.createElement("p",{className:"num-results"},"Found ",pluralize(e.length,"result","results")),1<s.length&&React.createElement("div",{className:"pages"},s))}}]),r}(),SearchResult=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var e;return"category"==this.props.item.type?e=this.props.item.txid?"#"+this.props.item.txid:"#":"entry"==this.props.item.type&&(e=this.props.item.link),React.createElement("div",{className:"search-result"},React.createElement("h4",null,React.createElement("a",{href:e},this.props.item.name)," ",React.createElement("span",{className:"badge badge-type-"+this.props.item.type},this.props.item.type)),"entry"==this.props.item.type&&React.createElement("a",{className:"url",href:this.props.item.link},this.props.item.link),React.createElement("div",{className:"satoshis"},satoshisToDollars(this.props.item.satoshis)),React.createElement(ReactMarkdown,{source:this.props.item.description}))}}]),e}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var TipchainItem=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={showingTipchain:!1,tip:SETTINGS.tip_amount,rand:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.handleTipSubmit=t.handleTipSubmit.bind(_assertThisInitialized(t)),t.handleClickTip=t.handleClickTip.bind(_assertThisInitialized(t)),t}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){window.addEventListener("hashchange",this.clearMoneyButton.bind(this),!1),this.handleTipSubmit()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.clearMoneyButton.bind(this))}},{key:"clearMoneyButton",value:function(){var e=document.getElementById(this.state.rand);if(e){var t=e.querySelector(".tip-money-button");if(t){var n=t.parentNode;n.removeChild(t);var a=document.createElement("div");a.className="tip-money-button",n.appendChild(a)}}}},{key:"handleTipSubmit",value:function(e){var t,n=this;if(e&&e.preventDefault(),!(t=this.props.custom_OP_RETURN?this.props.custom_OP_RETURN(this.props.item.txid):[OPENDIR_PROTOCOL,"vote",this.props.item.txid])||0==t.length)return alert("Invalid OP_RETURN generated for tip... please try again or contact the developers");console.log("OP_RETURN",t);var a=this.get_tipchain();if(a&&0!=a.length||confirm("Tipchain is invalid, please refresh or press OK to continue anyway")){var i=Number(this.state.tip);console.log("tipchain",a);var o=calculateTipPayment(a,i,SETTINGS.currency);console.log("payments",o);var r=document.getElementById(this.state.rand).querySelector(".tip-money-button");databutton.build({data:t,button:{$el:r,label:"upvote",$pay:{to:o},onPayment:function(e){console.log(e);var t=get_local_settings();t.tip_amount=i,use_local_settings(t),save_local_settings(t),setTimeout(function(){n.clearMoneyButton(),n.props.onSuccessHandler()},5e3)}}})}}},{key:"handleClickTip",value:function(e){var t=this,n=e.currentTarget.dataset.value;0<n&&this.setState({tip:n},function(){t.handleTipSubmit()})}},{key:"handleChangeTip",value:function(e){this.setState({tip:e.target.value})}},{key:"handleClickTipchain",value:function(e){this.setState({showingTipchain:!this.state.showingTipchain})}},{key:"get_tipchain",value:function(){return null==this.props.item.txid?SETTINGS.tip_addresses:this.props.item.tipchain}},{key:"render",value:function(){var e=expandTipchainInformation(this.get_tipchain(),this.state.tip,this.props.items);return React.createElement("div",{className:"tipping"},React.createElement("form",{onSubmit:this.handleTipSubmit.bind(this)},React.createElement("label",null,"Tip  ",React.createElement("a",{className:"suggested-tip","data-value":"0.05",onClick:this.handleClickTip},"5¢"),React.createElement("a",{className:"suggested-tip","data-value":"0.10",onClick:this.handleClickTip},"10¢"),React.createElement("a",{className:"suggested-tip","data-value":"0.25",onClick:this.handleClickTip},"25¢"),React.createElement("a",{className:"suggested-tip","data-value":"1.00",onClick:this.handleClickTip},"$1.00"),"$"),React.createElement("input",{className:"tip",type:"text",placeholder:"0.05",value:this.state.tip,onChange:this.handleChangeTip.bind(this)})," ",React.createElement("input",{type:"submit",className:"button button-outline",value:"tip"})),React.createElement("hr",null),React.createElement("div",{className:"tipchain"},React.createElement("p",null,React.createElement("a",{onClick:this.handleClickTipchain.bind(this)},pluralize(e.length,"address","addresses"))," in this tipchain"),this.state.showingTipchain&&React.createElement("ul",null,e.map(function(e,t){(100*Number(e.split)).toFixed(2);var n=t+e.type+e.address+e.split,a=Number(e.amount).toFixed(2);return 0<e.amount&&"0.00"==a&&(a=Number(e.amount).toFixed(3)),"opendirectory"==e.type?React.createElement("li",{key:n},"$",a," to ",React.createElement("strong",null,e.name)," ",e.address):"media"==e.type?React.createElement("li",{key:n},"$",a," to original content owner ",React.createElement("strong",null,e.address)):"category"==e.type?React.createElement("li",{key:n},"$",a," to ",React.createElement("strong",null,e.name)," category creator ",e.address):"entry"==e.type?React.createElement("li",{key:n},"$",a," to ",React.createElement("strong",null,e.name)," entry submitter ",e.address):React.createElement("li",{key:n},"$",a," ",React.createElement("strong",null,e.name)," ",e.address)})),React.createElement("div",{className:"money-button-wrapper",id:this.state.rand},React.createElement("div",{className:"tip-money-button"}))))}}]),n}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var DeleteItem=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)))._isMounted=!1,t.state={delete_reason:""},t}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){this._isMounted=!0,window.addEventListener("hashchange",this.clearMoneyButton.bind(this),!1)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,window.removeEventListener("hashchange",this.clearMoneyButton.bind(this))}},{key:"clearMoneyButton",value:function(){if(this._isMounted){var e=document.getElementById(this.props.item.txid);if(e){var t=e.querySelector(".delete-money-button");if(t){var n=t.parentNode;n.removeChild(t);var o=document.createElement("div");o.className="delete-money-button",n.appendChild(o)}}}}},{key:"handleDelete",value:function(e){var t=this;e.preventDefault();var n=this.props.item.type+".delete",o=[OPENDIR_PROTOCOL,n,this.props.item.txid];if(this.state.delete_reason)o.push(this.state.delete_reason);else if(!confirm("Are you sure you want to continue? You didn't specify a reason for deletion.\n\nProviding a reason helps everyone understand your thinking behind this change, and can prevent it from being reverted in the future."))return;console.log(o);var r=document.getElementById(this.props.item.txid).querySelector(".delete-money-button");databutton.build({data:o,button:{$el:r,onPayment:function(e){console.log(e),setTimeout(function(){t.setState({delete_reason:""}),t.clearMoneyButton(),t.props.onSuccessHandler()},5e3)}}})}},{key:"handleChangeDeleteReason",value:function(e){this.setState({delete_reason:e.target.value})}},{key:"render",value:function(){var e="If you remove this "+this.props.item.type+" you'll be permanently removing it from this directory for others to view. Please only do this if you think it's in the best interest of the directory. Your Bitcoin key is forever tied to this transaction, so it will always be traced to you.";return React.createElement("div",{className:"notice"},React.createElement("span",{className:"warning"},"You are about to delete this ",this.props.item.type,", are you sure you want to do this?"),React.createElement("div",{className:"explain"},React.createElement("p",null,e),React.createElement("p",null,React.createElement("strong",null,"What are you deleting this ",this.props.item.type,"?")),React.createElement("form",{onSubmit:this.handleDelete.bind(this)},React.createElement("input",{type:"text",placeholder:"reason for delete",value:this.state.delete_reason,onChange:this.handleChangeDeleteReason.bind(this)})," ",React.createElement("input",{type:"submit",className:"button button-outline",value:"delete"})),React.createElement("div",{className:"delete-money-button"})))}}]),n}();
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Item=function(){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).state={isExpanded:!1,action:null},e._isMounted=!1,e}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){this._isMounted=!0,window.addEventListener("hashchange",this.clearForm.bind(this),!1)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,window.removeEventListener("hashchange",this.clearForm.bind(this))}},{key:"handleSuccessfulTip",value:function(){this.setState({action:null}),this.props.onSuccessHandler("Successfully upvoted "+this.props.item.type+", it will appear automatically—please refresh the page if it doesn't")}},{key:"handleSuccessfulDelete",value:function(){this.setState({action:null}),this.props.onSuccessHandler("Successfully deleted "+this.props.item.type+", it will appear automatically—please refresh the page if it doesn't")}},{key:"clearForm",value:function(){this._isMounted&&this.setState({isExpanded:!1,action:null})}},{key:"handleUpvote",value:function(t){this.setState({action:"tipping"})}},{key:"handleToggleExpand",value:function(t){this.setState({isExpanded:!this.state.isExpanded,action:null})}},{key:"handleEdit",value:function(t){this.setState({action:"editing"})}},{key:"handleDelete",value:function(t){this.setState({action:"deleting"})}}]),n}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fork=function(){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={action:null,fork_address:null,tip_addresses:JSON.parse(JSON.stringify(SETTINGS.tip_addresses)),admin_address:SETTINGS.admin_address},t}return _inherits(a,React.Component),_createClass(a,[{key:"validate",value:function(){return!(0==this.state.tip_addresses.length&&!confirm("The tipchain doesn't have any addresses, are you sure you want to continue?"))&&(bsv.Address.isValid(this.state.admin_address)?!(this.state.admin_address==SETTINGS.admin_address&&!confirm("The admin address hasn't changed—you won't be able to admin this directory if you don't control this address. Are you sure you want to continue?")):(alert("The admin address doesn't look valid, please use a Bitcom generated address through the admin console"),!1))}},{key:"prepareOPReturnForPingback",value:function(e){if(e){var t=getBMediaURLForTXID(e);return[OPENDIR_PROTOCOL,"fork.soft",t]}return[OPENDIR_PROTOCOL,"fork.soft"]}},{key:"fetchTemplateByTXID",value:function(r){var e={v:3,sort:{txid:1},q:{find:{"tx.h":r},limit:1},r:{f:'[.[] | {                                  "height": .blk.i?,                        "time": .blk.t?,                        "address": .in[0].e.a,                    "txid": .tx.h,                            "data": .out[0]}]'}},t=toBase64(JSON.stringify(e)),s=SETTINGS.api_endpoint.replace("{api_key}",SETTINGS.api_key).replace("{api_action}","q").replace("{query}",t),l={headers:{key:SETTINGS.api_key}};return new Promise(function(a,n){console.log("Fetching template for txid",r),fetch(s,l).then(function(e){e?200!==e.status?n("Error response status code while fetching template"+e.status):e.json().then(function(e){var t=e.c.concat(e.u);0==t.length?n("Couldn't find template with txid "+r):1<t.length?n("Found too many templates for "+r):a(t[0])}):n("Error response while fetching template")})})}},{key:"handleSubmit",value:function(e){var l=this;if(e.preventDefault(),this.validate()){var t=this.props.template_txid;(t||(t=prompt("We didn't detect a template_txid — this is a b:// file that gets replicated when forking. Please enter one now to continue","enter template txid")))&&this.fetchTemplateByTXID(t).then(function(e){if(!e)throw"Error while fetching template during fork, please try again";var t=e.data;if(t.s1!==B_MEDIA_PROTOCOL&&"text/html"!==t.s3.toLowerCase()&&"utf-8"!==t.s4.toLowerCase())throw"Unknown template protocol, only b:// HTML templates currently supported";if(-1==t.ls2.indexOf("\x3c!-- BEGIN SETTINGS --\x3e"))throw"Missing \x3c!-- BEGIN SETTINGS --\x3e marker in template tag";if(-1==t.ls2.indexOf("\x3c!-- END SETTINGS --\x3e"))throw"Missing \x3c!-- END SETTINGS --\x3e marker in template tag";var a=[t.s1,t.ls2,t.s3,t.s4,t.s5],n=Object.assign(SETTINGS,{faq_markdown:l.props.faqMarkdown,intro_markdown:l.props.introMarkdown,theme:l.props.theme,tip_addresses:l.state.tip_addresses,admin_address:l.state.admin_addres,title:l.props.title,tip_amount:.05}),r="\x3c!-- BEGIN SETTINGS --\x3e\n<script>var SETTINGS = "+JSON.stringify(n,null,4)+";<\/script>\n\x3c!-- END SETTINGS --\x3e",s=t.ls2.replace(/<!-- BEGIN SETTINGS -->.*<!-- END SETTINGS -->/,r);console.log("NEW_HTML",s),a[1]=s,a[2]=l.props.title,console.log("OP_RETURN",a),l.setState({action:"forking"},function(){var e=document.querySelector(".fork-money-button");databutton.build({data:a,button:{$el:e,onPayment:function(e){console.log("HANDLE RESPONSE",e),l.handleForkResponse(e.txid)}}})})}).catch(function(e){console.log("error",e),l.props.onErrorHandler("Error while fetching template during fork, please try again")})}}},{key:"handleForkResponse",value:function(e){var a=this;if(e){console.log("Successfully forked to txid",e);var n=getBitLinkForBMediaTXID(e);console.log("Forked to",n),this.setState({action:"post-fork",fork_address:n},function(){var e=[OPENDIR_PROTOCOL,"fork.soft",n];console.log(e);var t=document.querySelector(".pingback-money-button");databutton.build({data:e,button:{$el:t,onPayment:function(e){console.log("PINGBACK RESPONSE",e),a.handleSuccessfulTip()}}})})}else alert("There was an error while forking—we didn't receive a valid txid. Please try again or contact the developers")}},{key:"removeTipChainTip",value:function(t){var e=this.state.tip_addresses.filter(function(e){return e.address!==t});this.setState({tip_addresses:e})}},{key:"handleChangeForkType",value:function(){console.log("CHANGE FORK TYPE")}},{key:"handleAddAddressToTipchain",value:function(){this.setState({action:"adding-tip-address"})}},{key:"handleCancelAddingAddressToTipchain",value:function(){this.setState({action:null})}},{key:"handleAddTipchainAddress",value:function(e){if(!e.address)return alert("Please enter a valid tip address");if(!bsv.Address.isValid(e.address))return alert("This Bitcoin address is not valid, please check and try again");var t=!0,a=!1,n=void 0;try{for(var r,s=this.state.tip_addresses[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){if(r.value.address==e.address)return alert("This address is already listed in the tipchain, try adding a different one")}}catch(e){a=!0,n=e}finally{try{t||null==s.return||s.return()}finally{if(a)throw n}}if(!e.name)return alert("Please enter a name for this address, it will help people understand where they're sending money");var l=this.state.tip_addresses;l.push(e),this.setState({action:null,tip_addresses:l})}},{key:"handleChangeAdminAddress",value:function(e){this.setState({admin_address:e.target.value})}},{key:"handleCategoryChange",value:function(e){var t=e.target.value;""==t&&(t=null),this.props.onChangeCategory(t)}},{key:"handleSuccessfulTip",value:function(){this.setState({action:"post-ping"})}},{key:"render",value:function(){for(var a=this,e=calculateTipchainSplits(this.state.tip_addresses),t=JSON.parse(JSON.stringify(this.state.tip_addresses)),n=0;n<t.length;n++)t[n].split=e[n];var r=SETTINGS.category?SETTINGS.category:"",s=this.props.items.filter(function(e){return e.txid==r}).unshift(),l=this.props.items.filter(function(e){return"category"==e.type});return l.unshift({txid:"",name:"Open Directory"}),React.createElement("div",{className:"fork"},React.createElement("a",{className:"close",onClick:this.props.onCloseFork},"X"),React.createElement("h2",null,React.createElement("i",{className:"fas fa-code-branch"})," Fork"),React.createElement("p",null,"Forking allows you to take control of a directory—to be the admin, change the theme, insert yourself in the tipchain—whatever you want."),React.createElement("form",{onSubmit:this.handleSubmit.bind(this)},React.createElement("fieldset",null,React.createElement("div",{className:"row compressed form-item"},React.createElement("div",{className:"column"},React.createElement("label",null,React.createElement("input",{type:"radio",value:"soft",checked:"checked",onChange:this.handleChangeForkType.bind(this)})," Soft Fork ",React.createElement("span",{className:"desc"},"— fork application")),React.createElement("label",null,React.createElement("input",{type:"radio",value:"soft",disabled:"disabled",onChange:this.handleChangeForkType.bind(this)})," Hard Fork ",React.createElement("span",{className:"desc"},"— fork data (coming soon)")))),React.createElement("div",{className:"row form-item"},React.createElement("div",{className:"column"},React.createElement("label",null,"Category"),React.createElement("p",null,"Select the category you want to fork. It will be published to the blockchain with a new Bitcoin URL where everyone can access it with the changes you've made. You can even fork the entire Open Directory."),React.createElement("select",{onChange:this.handleCategoryChange.bind(this),value:r},l.map(function(e){return React.createElement("option",{value:e.txid,key:e.txid},e.name)})))),React.createElement("div",{className:"row form-item"},React.createElement("div",{className:"column"},React.createElement("label",null,"Admin Address"),React.createElement("p",null,"Set the address that gets special rights, like notifying users about updated versions and detatching directories. ",React.createElement("a",{href:"https://github.com/synfonaut/OpenDirectory-Admin-Console",target:"_blank"},"Generate an Open Directory Admin Address")),React.createElement("input",{type:"text",value:this.state.admin_address,onChange:this.handleChangeAdminAddress.bind(this)}))),React.createElement("div",{className:"row form-item"},React.createElement("div",{className:"column"},React.createElement("label",null,"Default Tipchain"),React.createElement("p",null,"Specify which addresses get included in the tipchain"),React.createElement("table",{className:"tipchain"},React.createElement("tbody",null,t.map(function(e,t){return React.createElement("tr",{key:t,id:e.address},React.createElement("td",{className:"name"},React.createElement("strong",null,e.name),React.createElement("br",null),e.address),React.createElement("td",{className:"percentage"},numberFormat(100*e.split,2),"%"),React.createElement("td",{className:"remove"},React.createElement("a",{onClick:function(){a.removeTipChainTip(e.address)}},"x")))}),"adding-tip-address"!=this.state.action&&React.createElement("tr",null,React.createElement("td",{className:"add",colSpan:"3"},React.createElement("a",{onClick:this.handleAddAddressToTipchain.bind(this)},"Add address to tipchain"))),"adding-tip-address"==this.state.action&&React.createElement("tr",null,React.createElement("td",{className:"add",colSpan:"3"},React.createElement(AddTipchainAddressForm,{onSubmit:this.handleAddTipchainAddress.bind(this),onCancel:this.handleCancelAddingAddressToTipchain.bind(this)}))))))),React.createElement("div",{className:"row form-item"},React.createElement("div",{className:"column"},React.createElement("label",null,"Title"),React.createElement("p",null,"What is the name of your directory?"),React.createElement("input",{type:"text",value:this.props.title,onChange:this.props.onChangeTitle}))),React.createElement("div",{className:"row form-item"},React.createElement("div",{className:"column"},React.createElement("label",null,"Theme"),React.createElement("p",null,"Select a color scheme"),React.createElement("div",{className:"row select-a-theme"},React.createElement("div",{className:"column"},React.createElement("a",{className:"orange-theme"==this.props.theme?"active select-theme orange":"select-theme orange",onClick:function(){a.props.onChangeTheme("orange-theme")}})),React.createElement("div",{className:"column"},React.createElement("a",{className:"blue-theme"==this.props.theme?"active select-theme blue":"select-theme blue",onClick:function(){a.props.onChangeTheme("blue-theme")}})),React.createElement("div",{className:"column"},React.createElement("a",{className:"purple-theme"==this.props.theme?"active select-theme purple":"select-theme purple",onClick:function(){a.props.onChangeTheme("purple-theme")}})),React.createElement("div",{className:"column"},React.createElement("a",{className:"green-theme"==this.props.theme?"active select-theme green":"select-theme green",onClick:function(){a.props.onChangeTheme("green-theme")}}))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("label",null,"Intro"),React.createElement("p",null,"Optional text that goes at top of the home page of your directory. Only works when forking entire directory, otherwise use directory description (markdown supported)"),React.createElement("textarea",{value:this.props.introMarkdown,onChange:this.props.onIntroChange}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"column form-item"},React.createElement("label",null,"FAQ"),React.createElement("p",null,"Optional text that goes on FAQ page (markdown supported)"),React.createElement("textarea",{value:this.props.faqMarkdown,onChange:this.props.onFAQChange}))),(!this.state.action||"forking"==this.state.action)&&React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("p",null,React.createElement("i",{className:"fas fa-exclamation-triangle"})," ",React.createElement("strong",null,"You are about to fork.")," This will upload a new version of this application to the Bitcoin (SV) blockchain."),React.createElement("p",null,"Please take a moment to double check the settings above are correct. The most important one is the admin address",React.createElement("br",null),React.createElement("mark",null,React.createElement("strong",null,this.state.admin_address))),React.createElement("p",null,"If you lose control of this address, you lose control of the directory."),React.createElement("p",null,React.createElement("strong",null,"Remember this action is forever tied to your Bitcoin address.")),React.createElement("input",_defineProperty({type:"submit",className:"button",value:"Add new link"},"value","Fork")))),"forking"==this.state.action&&React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("br",null),React.createElement("p",null,React.createElement("strong",null,"Forking ",this.props.title,"...")),React.createElement("p",null,"Swipe the button below to fork this directory."),React.createElement("div",null,React.createElement("div",{className:"fork-money-button"})))))),"post-fork"==this.state.action&&React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("p",null,React.createElement("strong",null,React.createElement("i",{className:"far fa-check-circle"})," Successfully forked ",this.props.title," to ")),React.createElement("p",null,React.createElement("strong",null,React.createElement("a",{className:"url",href:this.state.fork_address},this.state.fork_address))),React.createElement("br",null),React.createElement("p",null,"Would you like to send a parting ping? This will help users find your directory—you can pay to rank higher up the list."),React.createElement("div",null,React.createElement(TipchainItem,{item:s,items:this.props.items,onSuccessHandler:this.handleSuccessfulTip.bind(this),onErrorHandler:this.props.onErrorHandler,custom_OP_RETURN:this.prepareOPReturnForPingback.bind(this)})))),"post-ping"==this.state.action&&React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("p",null,React.createElement("strong",null,React.createElement("i",{className:"far fa-check-circle"})," Successfully pinged ",this.props.title)),React.createElement("p",null,"Please refresh to see your directory listed as a fork."),React.createElement("p",null,React.createElement("strong",null,"Visit your directory at ",React.createElement("a",{className:"url",href:this.state.fork_address},this.state.fork_address))))))}}]),a}(),AddTipchainAddressForm=function(){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={address:"",name:""},t}return _inherits(a,React.Component),_createClass(a,[{key:"handleNameChange",value:function(e){this.setState({name:e.target.value})}},{key:"handleAddressChange",value:function(e){this.setState({address:e.target.value})}},{key:"clearForm",value:function(){this.setState({address:"",name:""})}},{key:"handleSubmit",value:function(){this.props.onSubmit({address:this.state.address,type:"opendirectory",name:this.state.name})}},{key:"render",value:function(){return React.createElement("fieldset",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("label",null,"Name:",React.createElement("input",{type:"text",value:this.state.name,onChange:this.handleNameChange.bind(this)}))),React.createElement("div",{className:"column"})),React.createElement("label",null,"Address:",React.createElement("input",{type:"text",value:this.state.address,onChange:this.handleAddressChange.bind(this)})),React.createElement("input",{type:"button",className:"button-outline",value:"Add tip address",onClick:this.handleSubmit.bind(this)}),"  ",React.createElement("a",{onClick:this.props.onCancel},"cancel"))}}]),a}(),ForkLog=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){var n=(new Date).getTime(),e=this.props.forks;e||(e=[]);var t=e.slice(0,10);return e&&0<e.length?React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("div",{id:"forklog"},React.createElement("h3",null,React.createElement("i",{className:"fas fa-code-branch"})," Forks"),React.createElement("table",null,React.createElement("tbody",null,t.map(function(e){var t=satoshisToDollars(e.satoshis,BSV_PRICE);t||(t="$0.00");var a=0<e.satoshis?e.satoshis+" sats":"";return React.createElement("tr",{key:e.txid},React.createElement("td",{className:"amount",title:a},t),React.createElement("td",{className:"time"},timeDifference(n,1e3*e.time)),React.createElement("td",{className:"url"},React.createElement("a",{href:e.fork_url},e.fork_url)))}))),React.createElement("br",null),React.createElement("hr",null)))):null}}]),e}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var EntryItem=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,Item),_createClass(e,[{key:"get_link",value:function(){return isBottle()?this.props.item.link:"https://bico.media/"+this.props.item.link}},{key:"render",value:function(){var e=(new Date).getTime(),t=satoshisToDollars(this.props.item.satoshis,BSV_PRICE,!0),n=React.createElement("span",{className:"actions"},React.createElement("a",{onClick:this.handleToggleExpand.bind(this),className:"arrow",title:"txid "+this.props.item.txid},this.state.isExpanded?React.createElement("i",{className:"fas fa-caret-right"}):React.createElement("i",{className:"fas fa-caret-down"})),this.state.isExpanded&&React.createElement("a",{className:"action",onClick:this.handleEdit.bind(this)},"edit"),this.state.isExpanded&&React.createElement("a",{className:"action",onClick:this.handleDelete.bind(this)},"delete"));return React.createElement("li",{id:this.props.item.txid,className:"entry"},React.createElement("div",{className:"upvoteContainer"},React.createElement("div",{className:"upvote"},React.createElement("a",{onClick:this.handleUpvote.bind(this)},React.createElement("i",{className:"fas fa-chevron-up"}))," ",React.createElement("span",{className:"number",title:this.props.item.satoshis+" sats"},t),React.createElement("br",null),React.createElement("span",{className:"number",title:this.props.item.hottness.toFixed(2)+" hot score"},this.props.item.votes)),React.createElement("div",{className:"entry"},React.createElement("h5",null,React.createElement("a",{href:this.get_link()},this.props.item.name)," ",!this.props.item.height&&React.createElement("span",{className:"pending"},"pending"),"  ",React.createElement("span",{className:"time"},timeDifference(e,1e3*this.props.item.time))," ",n),React.createElement("p",{className:"description"},this.props.item.description),React.createElement("p",{className:"url"},React.createElement("a",{href:this.get_link()},this.props.item.link)),"editing"==this.state.action&&React.createElement("div",{className:"inline-edit"},React.createElement(EditEntryForm,{item:this.props.item,onSuccessHandler:this.props.onSuccessHandler,onErrorHandler:this.props.onErrorHandler,onSubmit:this.clearForm.bind(this)})),"tipping"==this.state.action&&React.createElement(TipchainItem,{item:this.props.item,items:this.props.items,onSuccessHandler:this.handleSuccessfulTip.bind(this),onErrorHandler:this.props.onErrorHandler}),"deleting"==this.state.action&&React.createElement("div",{className:"inline-delete"},React.createElement(DeleteItem,{item:this.props.item,onSuccessHandler:this.handleSuccessfulDelete.bind(this),onErrorHandler:this.props.onErrorHandler}))),React.createElement("div",{className:"clearfix"})))}}]),e}(),AddEntryForm=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={title:"",link:"",description:""},t._isMounted=!1,t.handleTitleChange=t.handleTitleChange.bind(_assertThisInitialized(t)),t.handleLinkChange=t.handleLinkChange.bind(_assertThisInitialized(t)),t.handleDescriptionChange=t.handleDescriptionChange.bind(_assertThisInitialized(t)),t.handleSubmit=t.handleSubmit.bind(_assertThisInitialized(t)),t}return _inherits(n,React.Component),_createClass(n,[{key:"render",value:function(){return React.createElement("div",{className:"column"},React.createElement("h3",null,React.createElement("i",{className:"fas fa-link"})," Add new link to ",React.createElement("span",{className:"highlight"},this.props.category.name)),React.createElement("p",null,"Submit a link and earn money when it gets upvoted. Keep it high-quality, remember this action is forever tied to your Bitcoin address."),React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("fieldset",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("label",null,"Title:",React.createElement("input",{type:"text",value:this.state.title,onChange:this.handleTitleChange}))),React.createElement("div",{className:"column"})),React.createElement("label",null,"Link:",React.createElement("input",{type:"text",value:this.state.link,onChange:this.handleLinkChange,placeholder:"bit://"})),React.createElement("label",null,"Description:",React.createElement("textarea",{onChange:this.handleDescriptionChange,value:this.state.description})),React.createElement("input",{type:"submit",className:"button-outline",value:"Add new link"}),React.createElement("div",null,React.createElement("div",{className:"add-entry-money-button"})))))}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),this.validate()){var n=[OPENDIR_PROTOCOL,"entry.create",this.props.category.txid,"name",this.state.title,"link",this.state.link,"description",this.state.description];console.log(n);var i=document.querySelector(".add-entry-money-button");databutton.build({data:n,button:{$el:i,onPayment:function(e){console.log(e),setTimeout(function(){t.clearForm()},5e3),setTimeout(function(){t.setState({title:"",link:"",description:""}),t.props.onSuccessHandler("Successfully added new link, it will appear automatically—please refresh the page if it doesn't.")},3e3)}}})}}}]),_createClass(n,[{key:"componentDidMount",value:function(){window.addEventListener("hashchange",this.clearForm.bind(this),!1),this._isMounted=!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.clearForm.bind(this)),this._isMounted=!1}},{key:"clearForm",value:function(){if(this._isMounted){var e=document.querySelector(".add-entry-money-button");if(e){var t=e.parentNode;t.removeChild(e);var n=document.createElement("div");n.className="add-entry-money-button",t.appendChild(n)}this.setState({title:"",link:"",description:""})}}},{key:"validate",value:function(){return this.props.category?this.state.title?this.state.link?!(-1==this.state.link.indexOf("://")&&!confirm("The link doesn't look valid, are you sure you want to continue?"))&&(!!this.state.description||(alert("Invalid description"),!1)):(alert("Invalid link"),!1):(alert("Invalid title"),!1):(alert("Invalid category"),!1)}},{key:"handleTitleChange",value:function(e){this.setState({title:e.target.value})}},{key:"handleLinkChange",value:function(e){this.setState({link:e.target.value})}},{key:"handleDescriptionChange",value:function(e){this.setState({description:e.target.value})}}]),n}(),EditEntryForm=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={title:e.item.name,link:e.item.link,description:e.item.description,isShowingWarning:!1},t._isMounted=!1,t.handleTitleChange=t.handleTitleChange.bind(_assertThisInitialized(t)),t.handleLinkChange=t.handleLinkChange.bind(_assertThisInitialized(t)),t.handleDescriptionChange=t.handleDescriptionChange.bind(_assertThisInitialized(t)),t.handleSubmit=t.handleSubmit.bind(_assertThisInitialized(t)),t}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){window.addEventListener("hashchange",this.clearForm.bind(this),!1),this._isMounted=!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.clearForm.bind(this)),this._isMounted=!1}},{key:"clearForm",value:function(){if(this._isMounted){var e=document.getElementById(this.props.item.txid).querySelector(".change-entry-money-button");if(e){var t=e.parentNode;t.removeChild(e);var n=document.createElement("div");n.className="change-entry-money-button",t.appendChild(n)}this.setState({title:"",link:"",description:"",isShowingWarning:!1})}}},{key:"validate",value:function(){return this.state.title?this.state.link?!(-1==this.state.link.indexOf("://")&&!confirm("The link doesn't look valid, are you sure you want to continue?"))&&(!!this.state.description||(alert("Invalid description"),!1)):(alert("Invalid link"),!1):(alert("Invalid title"),!1)}},{key:"handleTitleChange",value:function(e){this.setState({title:e.target.value})}},{key:"handleLinkChange",value:function(e){this.setState({link:e.target.value})}},{key:"handleDescriptionChange",value:function(e){this.setState({description:e.target.value})}},{key:"render",value:function(){return React.createElement("div",{className:"column"},React.createElement("h3",null,"Edit link ",React.createElement("span",{className:"highlight"},this.props.item.name)),React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("fieldset",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("label",null,"Title:",React.createElement("input",{type:"text",value:this.state.title,onChange:this.handleTitleChange}))),React.createElement("div",{className:"column"})),React.createElement("label",null,"Link:",React.createElement("input",{type:"text",value:this.state.link,onChange:this.handleLinkChange,placeholder:"bit://"})),React.createElement("label",null,"Description:",React.createElement("textarea",{onChange:this.handleDescriptionChange,value:this.state.description})),React.createElement("input",{type:"submit",className:"button-outline",value:"Edit link"}),React.createElement("div",null,this.state.isShowingWarning&&React.createElement("div",{className:"notice"},React.createElement("span",{className:"warning"},"You are editing this link, are you sure you want to do this?"),React.createElement("div",{className:"explain"},React.createElement("p",null,"If you change this link you'll be permanently changing it in this directory for everyone else. Please only do this if you think it's in the best interest of the directory. Your Bitcoin key is forever tied to this transaction, so it will always be traced to you."),React.createElement("p",null,React.createElement("strong",null,"Permanently change this link?")),React.createElement("div",{className:"change-entry-money-button"})," "))))))}},{key:"handleSubmit",value:function(e){var i=this;if(e.preventDefault(),this.validate()){var t=[OPENDIR_PROTOCOL,"entry.update",this.props.item.txid],n=!1;this.props.item.name!=this.state.title&&(t.push("name"),t.push(this.state.title),n=!0),this.props.item.link!=this.state.link&&(t.push("link"),t.push(this.state.link),n=!0),this.props.item.description!=this.state.description&&(t.push("description"),t.push(this.state.description),n=!0),n?(console.log(t),this.setState({isShowingWarning:!0},function(){var e=document.getElementById(i.props.item.txid).querySelector(".change-entry-money-button");databutton.build({data:t,button:{$el:e,onPayment:function(e){console.log(e),setTimeout(function(){var e=i.state.title,t=i.state.description,n=i.state.link;i.clearForm(),i.setState({title:e,description:t,link:n}),i.props.onSubmit()},5e3),setTimeout(function(){i.setState({title:"",link:"",description:""}),i.props.onSuccessHandler("Successfully edited new link, it will appear automatically—please refresh the page if it doesn't.")},3e3)}}})})):alert("Nothing was edited with the category, please try again")}}}]),n}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var CategoryItem=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,Item),_createClass(e,[{key:"render",value:function(){var e=satoshisToDollars(this.props.item.satoshis,BSV_PRICE,!0);return React.createElement("li",{id:this.props.item.txid,className:"category"},React.createElement("div",{className:"upvoteContainer"},React.createElement("div",{className:"upvote"},React.createElement("a",{onClick:this.handleUpvote.bind(this)},React.createElement("i",{className:"fas fa-chevron-up"})," ")," ",React.createElement("span",{className:"number",title:this.props.item.satoshis+" sats"},e),React.createElement("br",null),React.createElement("span",{className:"number votes"},this.props.item.votes)),React.createElement("div",{className:"category"},React.createElement("h3",null,React.createElement("a",{href:"#"+this.props.item.txid,onClick:this.handleUpvote.bind(this)},this.props.item.name),!this.props.item.height&&React.createElement("span",{className:"pending"},"pending"),React.createElement("span",{className:"category-count"},"(",this.props.item.entries,")")),React.createElement(ReactMarkdown,{className:"description",source:this.props.item.description}),"tipping"==this.state.action&&React.createElement(TipchainItem,{item:this.props.item,items:this.props.items,onSuccessHandler:this.handleSuccessfulTip.bind(this),onErrorHandler:this.props.onErrorHandler})),React.createElement("div",{className:"clearfix"})))}}]),e}(),AddCategoryForm=function(){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={title:"",description:""},t._isMounted=!1,t.handleTitleChange=t.handleTitleChange.bind(_assertThisInitialized(t)),t.handleLinkChange=t.handleLinkChange.bind(_assertThisInitialized(t)),t.handleDescriptionChange=t.handleDescriptionChange.bind(_assertThisInitialized(t)),t.handleSubmit=t.handleSubmit.bind(_assertThisInitialized(t)),t}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e;this.props.category.txid;return e=this.props.category.txid?React.createElement("div",null,React.createElement("h3",null,React.createElement("i",{className:"fas fa-folder"})," Add new subcategory under ",React.createElement("span",{className:"highlight"},this.props.category.name)),React.createElement("p",null,"Submit a new subcategory to earn money when links get submitted and upvoted. Keep it high-quality, remember this action is forever tied to your Bitcoin address.")):React.createElement("div",null,React.createElement("h3",null,React.createElement("i",{className:"fas fa-folder"})," Add new directory"),React.createElement("p",null,"Submit a new directory to earn money when links and categories get submitted and upvoted. Keep it high-quality, remember this action is forever tied to your Bitcoin address.")),React.createElement("div",{className:"column",id:this.getCategoryID()},e,React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("fieldset",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("label",null,"Title:",React.createElement("input",{type:"text",value:this.state.title,onChange:this.handleTitleChange}))),React.createElement("div",{className:"column"})),React.createElement("label",null,"Description:",React.createElement("textarea",{onChange:this.handleDescriptionChange,value:this.state.description})),React.createElement("input",{type:"submit",className:"button button-outline",value:this.props.category.txid?"Add new subcategory":"Add new directory"}),React.createElement("div",null,React.createElement("div",{className:"add-category-money-button"})))))}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),this.validate()){var a=[OPENDIR_PROTOCOL,"category.create"];this.props.category.txid&&a.push(this.props.category.txid),a.push("name"),a.push(this.state.title),a.push("description"),a.push(this.state.description),console.log(a);var n=document.querySelector(".add-category-money-button");databutton.build({data:a,button:{$el:n,onPayment:function(e){console.log(e),setTimeout(function(){t.clearForm()},5e3),setTimeout(function(){t.setState({title:"",description:""}),t.props.onSuccessHandler("Successfully added new category, it will appear automatically—please refresh the page if it doesn't.")},3e3)}}})}}},{key:"getCategoryID",value:function(){return this.props.category.txid?this.props.category.txid:"root-category"}},{key:"componentDidMount",value:function(){window.addEventListener("hashchange",this.clearForm.bind(this),!1),this._isMounted=!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.clearForm.bind(this)),this._isMounted=!1}},{key:"clearForm",value:function(){if(this._isMounted){var e=document.querySelector(".add-category-money-button");if(e){var t=e.parentNode;t.removeChild(e);var a=document.createElement("div");a.className="add-category-money-button",t.appendChild(a)}this.setState({title:"",description:""})}}},{key:"validate",value:function(){return this.state.title?!!this.state.description||(alert("Invalid description"),!1):(alert("Invalid title"),!1)}},{key:"handleTitleChange",value:function(e){this.setState({title:e.target.value})}},{key:"handleLinkChange",value:function(e){this.setState({link:e.target.value})}},{key:"handleDescriptionChange",value:function(e){this.setState({description:e.target.value})}}]),a}(),EditCategoryForm=function(){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={title:e.category.name,description:e.category.description,isShowingWarning:!1},t._isMounted=!1,t.handleTitleChange=t.handleTitleChange.bind(_assertThisInitialized(t)),t.handleLinkChange=t.handleLinkChange.bind(_assertThisInitialized(t)),t.handleDescriptionChange=t.handleDescriptionChange.bind(_assertThisInitialized(t)),t.handleSubmit=t.handleSubmit.bind(_assertThisInitialized(t)),t}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"column",id:this.getCategoryID()},React.createElement("h3",null,"Edit ",React.createElement("span",{className:"highlight"},this.props.category.name)),React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("fieldset",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("label",null,"Title:",React.createElement("input",{type:"text",value:this.state.title,onChange:this.handleTitleChange}))),React.createElement("div",{className:"column"})),React.createElement("label",null,"Description:",React.createElement("textarea",{onChange:this.handleDescriptionChange,value:this.state.description})),React.createElement("input",{type:"submit",className:"button button-outline",value:"Edit category"}),React.createElement("div",null,this.state.isShowingWarning&&React.createElement("div",{className:"notice"},React.createElement("span",{className:"warning"},"You are editing this category, are you sure you want to do this?"),React.createElement("div",{className:"explain"},React.createElement("p",null,"If you change this category you'll be permanently changing it in this directory for everyone else. Please only do this if you think it's in the best interest of the directory. Your Bitcoin key is forever tied to this transaction, so it will always be traced to you."),React.createElement("p",null,React.createElement("strong",null,"Permanently change this category?")),React.createElement("div",{className:"change-category-money-button"})," "))))))}},{key:"handleSubmit",value:function(e){var a=this;if(e.preventDefault(),this.validate())if(this.props.category.txid){var t=[OPENDIR_PROTOCOL,"category.update",this.props.category.txid],n=!1;this.props.category.name!=this.state.title&&(t.push("name"),t.push(this.state.title),n=!0),this.props.category.description!=this.state.description&&(t.push("description"),t.push(this.state.description),n=!0),n?this.setState({isShowingWarning:!0},function(){console.log(t);var e=document.getElementById(a.getCategoryID()).querySelector(".change-category-money-button");databutton.build({data:t,button:{$el:e,onPayment:function(e){console.log(e),setTimeout(function(){var e=a.state.title,t=a.state.description;a.clearForm(),a.setState({title:e,description:t}),a.props.onSubmit()},5e3),setTimeout(function(){a.props.onSuccessHandler("Successfully edited category, it will appear automatically—please refresh the page if it doesn't.")},3e3)}}})}):alert("Nothing was edited with the category, please try again")}else alert("An unknown error occured, category doesn't have a txid to edit")}},{key:"getCategoryID",value:function(){return this.props.category.txid?this.props.category.txid:"root-category"}},{key:"componentDidMount",value:function(){window.addEventListener("hashchange",this.clearForm.bind(this),!1),this._isMounted=!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.clearForm.bind(this)),this._isMounted=!1}},{key:"clearForm",value:function(){if(this._isMounted){var e=document.getElementById(this.getCategoryID()).querySelector(".change-category-money-button");if(e){var t=e.parentNode;t.removeChild(e);var a=document.createElement("div");a.className="change-category-money-button",t.appendChild(a)}this.setState({title:"",description:"",isShowingWarning:!1})}}},{key:"validate",value:function(){return this.state.title?!!this.state.description||(alert("Invalid description"),!1):(alert("Invalid title"),!1)}},{key:"handleTitleChange",value:function(e){this.setState({title:e.target.value})}},{key:"handleLinkChange",value:function(e){this.setState({link:e.target.value})}},{key:"handleDescriptionChange",value:function(e){this.setState({description:e.target.value})}}]),a}(),AddDirectoryPage=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,React.Component),_createClass(e,[{key:"render",value:function(){return React.createElement("div",null,React.createElement("br",null),React.createElement(AddCategoryForm,{category:this.props.category,onSuccessHandler:this.props.onSuccessHandler,onErrorHandler:this.props.onErrorHandler}))}}]),e}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var List=function(){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={sort:"hot",limit:10,category_limit:6,cursor:0,action:null,isExpanded:!1},t._isMounted=!1,t}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidMount",value:function(){this._isMounted=!0,window.addEventListener("hashchange",this.clearForm.bind(this),!1)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,window.removeEventListener("hashchange",this.clearForm.bind(this))}},{key:"clearForm",value:function(){this._isMounted&&this.setState({action:null,isExpanded:!1,cursor:0})}},{key:"findCategoryByTXID",value:function(t){return this.props.items.filter(function(e){return"category"==e.type&&e.txid==t}).shift()}},{key:"handleChangeSortOrder",value:function(e){"time"==e?this.setState({sort:"time"}):"votes"==e?this.setState({sort:"votes"}):"money"==e?this.setState({sort:"money"}):this.setState({sort:"hot"})}},{key:"handlePageChange",value:function(e){var t=(e-1)*this.state.limit;this.setState({cursor:t})}},{key:"handleSuccessfulTip",value:function(){this.setState({action:null}),this.props.onSuccessHandler("Successfully upvoted "+this.props.category.type+", it will appear automatically—please refresh the page if it doesn't")}},{key:"handleShowAllCategories",value:function(){this.setState({category_limit:-1})}},{key:"handleSuccessfulDelete",value:function(){this.setState({action:null}),this.props.onSuccessHandler("Successfully deleted "+this.props.category.type+", it will appear automatically—please refresh the page if it doesn't")}},{key:"handleUpvote",value:function(e){this.setState({action:"tipping"})}},{key:"handleToggleExpand",value:function(e){this.setState({isExpanded:!this.state.isExpanded,action:null})}},{key:"handleEdit",value:function(e){this.setState({action:"editing"})}},{key:"handleDelete",value:function(e){this.setState({action:"deleting"})}},{key:"render",value:function(){var e,r=this,t=this.getCategories();e=-1==this.state.category_limit?t:t.slice(0,this.state.category_limit);var a,s,n,i,o=this.getEntries(),c=satoshisToDollars(this.props.category.satoshis,BSV_PRICE,!0),l=o.slice(this.state.cursor,this.state.cursor+this.state.limit),h=Math.ceil(o.length/this.state.limit),u=_toConsumableArray(Array(h).keys()).map(function(e){var t=e+1;return React.createElement("a",{key:"page-"+t,className:r.state.cursor==e*r.state.limit?"active":null,onClick:function(){r.handlePageChange(t)}},t)}),p=React.createElement("span",{className:"actions"},React.createElement("a",{onClick:this.handleToggleExpand.bind(this),className:"arrow",title:"txid "+this.props.category.txid},this.state.isExpanded?React.createElement("i",{class:"fas fa-caret-right"}):React.createElement("i",{className:"fas fa-caret-down"})),this.state.isExpanded&&React.createElement("a",{className:"action",onClick:this.handleEdit.bind(this)},"edit"),this.state.isExpanded&&React.createElement("a",{className:"action",onClick:this.handleDelete.bind(this)},"delete"));if(this.props.category&&this.props.category.category&&(a=this.findCategoryByTXID(this.props.category.category)),this.props.category){if(a){var m=get_root_category_txid();if(null==m||this.props.category.txid!==m){var d="/#"+a.txid;a.txid==m&&(d="/#"),s=React.createElement("div",{className:"back"},React.createElement("a",{href:d},React.createElement("i",{className:"fas fa-long-arrow-alt-left"})," ",a.name),React.createElement("hr",null))}}this.props.category.name&&(n=React.createElement("div",{className:"category-meta",id:this.props.category.txid},s,React.createElement("div",{className:"upvoteContainer"},React.createElement("div",{className:"upvote"},React.createElement("a",{onClick:this.handleUpvote.bind(this)},React.createElement("i",{className:"fas fa-chevron-up"}))," ",React.createElement("span",{className:"number",title:this.props.category.satoshis+" sats"},c),React.createElement("br",null),React.createElement("span",{className:"number"},this.props.category.votes)),React.createElement("div",null,React.createElement("h1",null,this.props.category.name,p),this.state.action&&React.createElement("div",{className:"category-container"},"editing"==this.state.action&&React.createElement("div",{className:"column"},React.createElement(EditCategoryForm,{category:this.props.category,onSuccessHandler:this.props.onSuccessHandler,onErrorHandler:this.props.onErrorHandler,onSubmit:this.clearForm.bind(this)})),"tipping"==this.state.action&&React.createElement(TipchainItem,{item:this.props.category,items:this.props.items,onSuccessHandler:this.handleSuccessfulTip.bind(this),onErrorHandler:this.props.onErrorHandler}),"deleting"==this.state.action&&React.createElement(DeleteItem,{item:this.props.category,onSuccessHandler:this.handleSuccessfulDelete.bind(this),onErrorHandler:this.props.onErrorHandler})),React.createElement("div",{className:"markdown"},React.createElement(ReactMarkdown,{source:this.props.category.description}))),React.createElement("div",{className:"clearfix"}))))}this.props.category.address&&0<l.length?i=React.createElement("div",null,React.createElement("div",{className:"sort"},React.createElement("span",{className:"label"},"sort by"),React.createElement("ul",null,React.createElement("li",null,React.createElement("a",{onClick:function(){r.handleChangeSortOrder("hot")},className:"hot"==this.state.sort?"active":""},"hot")),React.createElement("li",null,React.createElement("a",{onClick:function(){r.handleChangeSortOrder("money")},className:"money"==this.state.sort?"active":""},"money")),React.createElement("li",null,React.createElement("a",{onClick:function(){r.handleChangeSortOrder("votes")},className:"votes"==this.state.sort?"active":""},"votes")),React.createElement("li",null,React.createElement("a",{onClick:function(){r.handleChangeSortOrder("time")},className:"time"==this.state.sort?"active":""},"new"))),React.createElement("div",{className:"clearfix"})),React.createElement("ul",{className:"entry list"},l.map(function(e){return React.createElement(EntryItem,{key:"entry-"+e.txid,item:e,items:r.props.items,onSuccessHandler:r.props.onSuccessHandler,onErrorHandler:r.props.onErrorHandler})})),1<u.length&&React.createElement("div",{className:"pages"},u)):!this.props.isError&&!this.props.isLoading&&this.props.category&&this.props.category.txid&&(i=React.createElement("div",{className:"empty-entry-listing"},React.createElement("p",null,React.createElement("i",{className:"fas fa-link"})),React.createElement("p",null,"There's no links here yet—you should submit one! If you submit a good one and it gets upvoted, you'll get paid Bitcoin (SV)! 👍")));var f=null==this.props.category.txid;return React.createElement("div",null,n,t&&0<t.length&&React.createElement("div",{className:f?"homepage":"subcategories"},React.createElement("ul",{className:"category list"},e.map(function(e,t){var a=React.createElement(CategoryItem,{key:"category-"+e.txid,item:e,items:r.props.items,onSuccessHandler:r.props.onSuccessHandler,onErrorHandler:r.props.onErrorHandler});return(t+1)%3==0?[a,React.createElement("div",{key:"category-clearfix-"+t,className:"clearfix three-column"})]:(t+1)%2==0?[a,React.createElement("div",{key:"category-clearfix-"+t,className:"clearfix two-column"})]:a}),t.length>e.length&&React.createElement("li",{className:"show-more"},React.createElement("a",{onClick:this.handleShowAllCategories.bind(this)},"Show all ",t.length," categories")),React.createElement("div",{className:"clearfix"})),React.createElement("div",{className:"clearfix"})),i,React.createElement("div",{className:"clearfix"}))}},{key:"getCategories",value:function(){var t=this.props.category?this.props.category.txid:get_root_category_txid();return this.props.items.filter(function(e){return!e.deleted&&"category"==e.type&&e.category==t}).sort(function(e,t){return e.satoshis<t.satoshis?1:e.satoshis>t.satoshis?-1:e.votes<t.votes?1:e.votes>t.votes?-1:e.entries<t.entries?1:e.entries>t.entries?-1:e.height<t.height?1:e.height>t.height?-1:0})}},{key:"getEntries",value:function(){var a=this;return this.props.category?this.props.items.filter(function(e){return!e.deleted&&"entry"==e.type&&e.category&&e.category==a.props.category.txid}).sort(function(e,t){if("time"==a.state.sort){if(!e.height)return-1;if(e.height<t.height)return 1;if(e.height>t.height)return-1}else if("votes"==a.state.sort){if(e.votes<t.votes)return 1;if(e.votes>t.votes)return-1;if(e.height<t.height)return 1;if(e.height>t.height)return-1}else if("money"==a.state.sort){if(e.satoshis<t.satoshis)return 1;if(e.satoshis>t.satoshis)return-1;if(e.votes<t.votes)return 1;if(e.votes>t.votes)return-1;if(e.height<t.height)return 1;if(e.height>t.height)return-1}else{if(e.hottness<t.hottness)return 1;if(e.hottness>t.hottness)return-1;if(e.satoshis<t.satoshis)return 1;if(e.satoshis>t.satoshis)return-1;if(e.votes<t.votes)return 1;if(e.votes>t.votes)return-1;if(e.height<t.height)return 1;if(e.height>t.height)return-1}return 0}):[]}}]),a}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ChangeLog=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={isExpanded:!1,isShowAll:!1},t}return _inherits(n,React.Component),_createClass(n,[{key:"handleToggleExpand",value:function(e){this.setState({isExpanded:!this.state.isExpanded})}},{key:"handleToggleShowAll",value:function(e){this.setState({isShowAll:!this.state.isShowAll})}},{key:"render",value:function(){var t=this,n=0,e=(this.props.changelog?this.props.changelog.slice(0).reverse():[]).filter(function(e){return e.data.s1==OPENDIR_PROTOCOL||e.data.s1==SETTINGS.admin_address});return e&&0<e.length&&React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},React.createElement("div",{id:"changelog"},React.createElement("h3",null,React.createElement("i",{className:"fas fa-history"})," Changelog"),React.createElement("table",null,React.createElement("tbody",null,e.map(function(e){if(n++<=5||t.state.isShowAll)return React.createElement(ChangeLogItem,{item:e,txpool:t.props.txpool,key:"changelog-"+e.txid,onSuccessHandler:t.props.onSuccessHandler,onErrorHandler:t.props.onErrorHandler,isExpanded:t.state.isExpanded})})),!this.state.isShowingWarning&&5<e.length&&React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{colSpan:"6",className:"expand"},React.createElement("a",{onClick:this.handleToggleShowAll.bind(this)},this.state.isShowAll?"Hide":"Show"," all ",e.length," changes from changelog")," ",React.createElement("a",{onClick:this.handleToggleExpand.bind(this)},"expanded"))))))))}}]),n}(),ChangeLogItem=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={isShowingWarning:!1,isExpanded:!1,undo_reason:""},t}return _inherits(n,React.Component),_createClass(n,[{key:"clearForm",value:function(){var e=document.getElementById("changelog-action-"+this.props.item.txid).querySelector(".undo-money-button");if(e){var t=e.parentNode;t.removeChild(e);var n=document.createElement("div");n.className="undo-money-button",t.appendChild(n)}}},{key:"handleClickUndo",value:function(e){e.preventDefault(),this.setState({isShowingWarning:!0})}},{key:"handleUndoSubmit",value:function(e){var t=this;e.preventDefault();var n=findObjectByTX(this.props.item.txid,this.props.txpool);if(n){var a=findRootActionID(n,this.props.txpool);a||alert("Error while finding undo object action_id, please try again");var o=[OPENDIR_PROTOCOL,"undo",a,this.props.item.txid];if(this.state.undo_reason)o.push(this.state.undo_reason);else if(!confirm("Are you sure you want to continue? You didn't specify an undo reason.\n\nProviding a reason helps everyone understand your thinking behind this change, and can prevent it from being reverted in the future."))return;console.log(o);var i=document.getElementById("changelog-action-"+this.props.item.txid).querySelector(".undo-money-button");databutton.build({data:o,button:{$el:i,onPayment:function(e){setTimeout(function(){t.clearForm(),t.setState({isShowingWarning:!1,isExpanded:!1,undo_reason:""}),t.props.onSuccessHandler("Successfully reversed transaction, it will appear automatically—please refresh the page if it doesn't.")},3e3)}}})}else alert("Error while finding undo object, please try again")}},{key:"handleToggleExpand",value:function(e){this.setState({isExpanded:!this.state.isExpanded,isShowingWarning:!1})}},{key:"handleChangeUndoReason",value:function(e){this.setState({undo_reason:e.target.value})}},{key:"render",value:function(){var e,t=(new Date).getTime(),n=satoshisToDollars(this.props.item.satoshis,BSV_PRICE),a=0<this.props.item.satoshis?this.props.item.satoshis+" sats":"";e="admin"==this.props.item.type?this.props.item.type+"."+this.props.item.action:this.props.item.data.s2;var o=!0;return"admin"==this.props.item.type?o=!1:"fork"==this.props.item.type&&(o=!1),React.createElement(React.Fragment,null,React.createElement("tr",null,React.createElement("td",{className:"height"},React.createElement("a",{onClick:this.handleToggleExpand.bind(this),className:"arrow"},this.props.isExpanded||this.state.isExpanded?React.createElement("i",{className:"fas fa-caret-down"}):React.createElement("i",{className:"fas fa-caret-right"})),this.props.item.height?React.createElement("span",{className:"block"},"#",this.props.item.height):React.createElement("span",{className:"pending"},"pending")),React.createElement("td",{className:"action"},e),React.createElement("td",{className:"time"},timeDifference(t,1e3*this.props.item.time)),React.createElement("td",{className:"amount",title:a},n),React.createElement("td",{className:"description"},this.props.item.description),React.createElement("td",{className:"address"},this.props.item.address)),(this.props.isExpanded||this.state.isExpanded)&&React.createElement("tr",null,React.createElement("td",{className:"data",colSpan:"6"},React.createElement("pre",null,React.createElement("code",null,JSON.stringify(this.props.item.data,null,4))))),(this.props.isExpanded||this.state.isExpanded)&&React.createElement("tr",null,React.createElement("td",{className:"undo",colSpan:"6",id:"changelog-action-"+this.props.item.txid},React.createElement("a",{href:"https://whatsonchain.com/tx/"+this.props.item.txid},this.props.item.txid)," ",o&&React.createElement("a",{onClick:this.handleClickUndo.bind(this)},"undo"),this.state.isShowingWarning&&React.createElement("div",{className:"notice"},React.createElement("span",{className:"warning"},"You are undoing this change, are you sure you want to do this?"),React.createElement("div",{className:"explain"},React.createElement("p",null,"If you undo this change, you'll be permanently undoing it in this directory for everyone else. Please only do this if you think it's in the best interest of the directory. Your Bitcoin key is forever tied to this transaction, so it will always be traced to you."),React.createElement("p",null,React.createElement("strong",null,"Why are you undoing this change?")),React.createElement("form",{onSubmit:this.handleUndoSubmit.bind(this)},React.createElement("input",{type:"text",placeholder:"reason for undo",value:this.state.undo_reason,onChange:this.handleChangeUndoReason.bind(this)})," ",React.createElement("input",{type:"submit",className:"button button-outline",value:"undo"})),React.createElement("div",{className:"undo-money-button"})," ")))))}}]),n}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var OpenDirectoryApp=function(){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={isLoading:!0,isError:!1,isExpandingAddCategoryForm:!1,isExpandingAddEntryForm:!1,isForking:!1,location:[""],messages:[],raw:{},txpool:[],items:[],cache:{},admin_actions:[],taches:[],category:{txid:get_root_category_txid(),needsupdate:!0},title:SETTINGS.title,intro_markdown:SETTINGS.intro_markdown,faq_markdown:SETTINGS.faq_markdown,theme:SETTINGS.theme,template_txid:SETTINGS.template_txid},t.NETWORK_DELAY=0,t._isMounted=!1,t.addSuccessMessage=t.addSuccessMessage.bind(_assertThisInitialized(t)),t.addErrorMessage=t.addErrorMessage.bind(_assertThisInitialized(t)),t}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidCatch",value:function(e,t){console.log("ERROR",e,t)}},{key:"componentDidMount",value:function(){this._isMounted=!0,this.didUpdateLocation(),this.performAdminActionsFetch(),this.detectTemplateIDFromAddress(),updateBitcoinSVPrice(),window.addEventListener("hashchange",this.didUpdateLocation.bind(this),!1)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"addMessage",value:function(e,t,a,n){var s=this,i=2<arguments.length&&void 0!==a?a:null,r=3<arguments.length&&void 0!==n?n:5e3,o=(new Date).getTime(),c=this.state.messages.concat([{type:t,message:e,key:o}]);this.setState({messages:c},function(){setTimeout(function(){s.hideMessage(o)},r),i&&i()})}},{key:"addSuccessMessage",value:function(e,t,a){var n=1<arguments.length&&void 0!==t?t:null,s=2<arguments.length&&void 0!==a?a:5e3;this.addMessage(e,"success",n,s)}},{key:"addErrorMessage",value:function(e,t,a){var n=1<arguments.length&&void 0!==t?t:null,s=2<arguments.length&&void 0!==a?a:5e3;this.addMessage(e,"error",n,s)}},{key:"hideMessage",value:function(t){var e=this.state.messages.filter(function(e){return e.key!=t});this.setState({messages:e})}},{key:"detectTemplateIDFromAddress",value:function(){if(!this.state.template_txid){var e,t=document.location.href;if(-1!==t.indexOf("bit://")){var a=t.split("/");if(4!==a.length)return void console.log("Unable to detect template ID from address, unknown parts in url");if(a[2]!==B_MEDIA_PROTOCOL&&a[2]!==BCAT_MEDIA_PROTOCOL)return void console.log("Unable to detect template ID from address, unknown parts in url");e=a[3]}else if(-1!==t.indexOf("b://")||-1!==t.indexOf("bcat://")){e=t.split("/")[2]}if(e){if(64!==e.length)return void console.log("Unable to detect valid template ID from address, invalid tx");console.log("Successfully detected template_txid",e,"from address",t),this.setState({template_txid:e})}}}},{key:"handleCloseFork",value:function(){this.setState({isForking:!1})}},{key:"handleChangeTitle",value:function(e){this.setState({title:e.target.value})}},{key:"didChangeFAQHandler",value:function(e){console.log("FAQ",e.target.value),this.setState({faq_markdown:e.target.value})}},{key:"handleToggleFork",value:function(){this.setState({isForking:!this.state.isForking})}},{key:"didChangeIntroHandler",value:function(e){this.setState({intro_markdown:e.target.value})}},{key:"handleChangeTheme",value:function(e){this.setState({theme:e})}},{key:"buildChangeLog",value:function(a){var n=this,e=processAdminResults(this.state.admin_actions).filter(function(e){if(!a&&"uri"==e.type)return!0;if(e.action_id==a)return!0;if(e.action_id){var t=findObjectByTX(e.action_id,n.state.items);if(t&&"category"==t.type&&(!t.category_id||t.txid==e.action_id))return!0}return!1}),t=this.state.raw[this.state.category.txid];return t||(t=[]),(t=t.filter(function(e){return-1!==OPENDIR_ACTIONS.indexOf(e.data.s2)})).concat(e).sort(function(e,t){return(null===e.height)-(null===t.height)||+(e.height>t.height)||-(e.height<t.height)})}},{key:"handleChangeCategory",value:function(e){SETTINGS.category=e,this.didUpdateLocation()}},{key:"getForks",value:function(){this.state.category.txid;return this.state.txpool.filter(function(e){return"fork"==e.type}).sort(function(e,t){return e.satoshis<t.satoshis?1:e.satoshis>t.satoshis?-1:0})}},{key:"handleExpandAddCategoryForm",value:function(){this.setState({isExpandingAddCategoryForm:!0})}},{key:"handleExpandAddEntryForm",value:function(){this.setState({isExpandingAddEntryForm:!0})}},{key:"render",value:function(){var e,t,a,n,s,i,r=this.state.location[0],o=!1,c=!1;if("faq"==r)e=React.createElement("div",{className:"faq"},React.createElement(ReactMarkdown,{source:this.state.faq_markdown}));else if("search"==r)e=React.createElement(SearchPage,{title:this.state.title,items:this.state.items,category:this.state.category});else if("add-directory"==r)e=React.createElement(AddDirectoryPage,{category:this.state.category,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage});else{if(this.state.isLoading||this.state.isError||(o=!0,this.state.category.txid&&(c=!0)),n=this.buildChangeLog(this.state.category.txid),s=this.getForks(),!this.state.isError){var l=this.filterOutDetaches(this.state.items);e=React.createElement("div",{className:"list-wrapper"},React.createElement(List,{items:l,category:this.state.category,isError:this.state.isError,isLoading:this.state.isLoading,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage}))}t=React.createElement("div",{className:"loading"},React.createElement("div",{className:"spinner"},React.createElement("div",{className:"bounce1"}),React.createElement("div",{className:"bounce2"}),React.createElement("div",{className:"bounce3"})),React.createElement("p",null,"Loading ",this.state.title,"...")),a=React.createElement("div",null,React.createElement("h2",null,"Error"),React.createElement("p",null,React.createElement("strong",null,"Sorry, there was an error while loading open directory information. Please refresh to try again or contact ",React.createElement("a",{href:"https://twitter.com/synfonaut"},"@synfonaut"))),React.createElement("br",null),React.createElement("p",null,React.createElement("button",{onClick:function(){location.reload()},className:"button button-outline"},"Refresh This Page")))}return this.state.intro_markdown&&(i=React.createElement("div",{className:"intro"},React.createElement("h1",null,React.createElement("i",{className:"fas fa-sitemap"})," Open Directory"),React.createElement(ReactMarkdown,{source:this.state.intro_markdown}))),React.createElement("div",{className:this.state.theme+" wrapper"},this.state.isForking&&React.createElement(Fork,{onCloseFork:this.handleCloseFork.bind(this),onErrorHandler:this.addErrorMessage,introMarkdown:this.state.intro_markdown,onIntroChange:this.didChangeIntroHandler.bind(this),theme:this.state.theme,onChangeTheme:this.handleChangeTheme.bind(this),title:this.state.title,onChangeTitle:this.handleChangeTitle.bind(this),faqMarkdown:this.state.faq_markdown,onFAQChange:this.didChangeFAQHandler.bind(this),items:this.state.items,onChangeCategory:this.handleChangeCategory.bind(this),template_txid:this.props.template_txid}),React.createElement("nav",{className:"navigation"},React.createElement("section",{className:"container"},React.createElement("a",{href:"/#",className:"navigation-title"},React.createElement("i",{className:"fas fa-sitemap"}),this.state.title),React.createElement("div",{className:this.state.networkActive?"spinner white active":"spinner white"},React.createElement("div",{className:"bounce1"}),React.createElement("div",{className:"bounce2"}),React.createElement("div",{className:"bounce3"})),React.createElement("ul",{className:"navigation-list float-right"},React.createElement("li",{className:"navigation-item"},React.createElement("a",{className:"navigation-link nav-search",href:"#search"},React.createElement("i",{className:"fas fa-search"}," "),"Search"),React.createElement("a",{className:"navigation-link nav-faq",href:"#faq"},"FAQ"),React.createElement("a",{className:"navigation-link nav-fork",onClick:this.handleToggleFork.bind(this)},"Fork"))))),React.createElement("div",{className:"container"},React.createElement("div",{className:"open-directory"},React.createElement(PoseGroup,null,0<this.state.messages.length&&React.createElement(MessageGroup,{key:"message_group",className:"messages"},this.state.messages.map(function(e){return React.createElement(Message,{key:e.key,className:"message "+e.type},e.message)}))),""==r&&i,e,this.state.isLoading&&0==this.state.items.length&&t,this.state.isError&&a,React.createElement("hr",null),React.createElement("div",{className:"row"},c?React.createElement("div",{className:"column"},!this.state.isExpandingAddEntryForm&&React.createElement("div",{className:"add-entry-callout"},React.createElement("a",{onClick:this.handleExpandAddEntryForm.bind(this)},React.createElement("i",{class:"fas fa-link"})," Submit a new link"),React.createElement("p",null,"Earn ",React.createElement("i",{className:"fab fa-bitcoin"})," Bitcoin (SV) by submitting valuable content—when it gets upvoted you'll receive a portion of the tip!")),this.state.isExpandingAddEntryForm&&React.createElement(AddEntryForm,{category:this.state.category,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage})):null,o&&!c?React.createElement("div",{className:"row"},React.createElement("div",{className:"column"},!this.state.isExpandingAddCategoryForm&&React.createElement("div",{className:"add-directory-callout"},React.createElement("a",{onClick:this.handleExpandAddCategoryForm.bind(this)},React.createElement("i",{class:"fas fa-folder"})," Create a new directory"),React.createElement("p",null,"Earn ",React.createElement("i",{className:"fab fa-bitcoin"})," Bitcoin (SV) by creating a new directory—when someone submits content and it gets upvoted you'll receive a portion of the tip! ")),this.state.isExpandingAddCategoryForm&&React.createElement(AddCategoryForm,{category:this.state.category,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage})),React.createElement("div",{className:"column"})):null,o&&c?React.createElement("div",{className:"column"},!this.state.isExpandingAddCategoryForm&&React.createElement("div",{className:"add-category-callout"},React.createElement("a",{onClick:this.handleExpandAddCategoryForm.bind(this)},React.createElement("i",{class:"fas fa-folder"})," Create a new subcategory "),React.createElement("p",null,"Earn ",React.createElement("i",{className:"fab fa-bitcoin"})," Bitcoin (SV) by creating a new subcategory—when someone submits content and it gets upvoted you'll receive a portion of the tip! ")),this.state.isExpandingAddCategoryForm&&React.createElement(AddCategoryForm,{category:this.state.category,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage})):null),(c||o)&&React.createElement("hr",null),!this.state.isLoading&&React.createElement(ForkLog,{forks:s,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage}),!this.state.isLoading&&React.createElement(ChangeLog,{changelog:n,txpool:this.state.txpool,category:this.state.category,onSuccessHandler:this.addSuccessMessage,onErrorHandler:this.addErrorMessage}))))}},{key:"performAdminActionsFetch",value:function(){var t=this;getCachedAdminActions().then(function(e){t.setState({admin_actions:e}),t.performAdminUpdateCheck()}).catch(function(e){console.log("Error while checking for admin actions",e),t.addErrorMessage("Error while checking for admin actions")})}},{key:"performAdminUpdateCheck",value:function(){var a=this;"dir1.sv"!=document.location.hostname?getLatestUpdate().then(function(e){if(document.location.origin!=e.uri){console.log("Current location doesn't match latest update URI...new version available",document.location.origin,e.uri);var t=React.createElement("a",{href:e.uri},"new version");a.addSuccessMessage(React.createElement("div",null,a.state.title," has a ",t," available, check it out!"),null,1e4)}else console.log("Using most recent version of app")}):console.log("Skipping app update check since running at http/https")}},{key:"filterOutDetaches",value:function(e){var t=processAdminResults(this.state.admin_actions).filter(function(e){return"attach"==e.action||"detach"==e.action});if(0<e.length&&0<t.length){var a=!0,n=!1,s=void 0;try{for(var i,r=t[Symbol.iterator]();!(a=(i=r.next()).done);a=!0){var o=i.value,c=findObjectByTX(o.action_id,e);c&&("detach"==o.action?c.detached=!0:"attach"==o.action&&delete c.detached)}}catch(e){n=!0,s=e}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}}return e.filter(function(e){return!e.detached})}},{key:"getLocation",value:function(){return window.location.hash.replace(/^#\/?|\/$/g,"").split("/")}},{key:"didUpdateLocation",value:function(){var e=this,t=this.getLocation(),a=t[0];console.log("location updated",a);var n=this.state.category,s=[],i=this.state.title,r=!1;if("faq"==a)i="FAQ "+this.state.title;else if("search"==a)i="Search "+this.state.title,r=!0;else if("add-directory"==a)i="Add directory to "+this.state.title,r=!0;else{var o=""==a?get_root_category_txid():a,c=this.state.cache[o];if(n={txid:o,needsdata:!0},r=!0,c){var l=findObjectByTX(o,s=c);l&&(l.needsdata=!0,i=n.name+" — "+this.state.title,n=l)}}document.title=i,t!==this.state.location&&window.scrollTo(0,0),this.setState({location:t,category:n,items:s,isExpandingAddCategoryForm:!1,isExpandingAddEntryForm:!1},function(){r&&e.networkAPIFetch()})}},{key:"networkAPIFetch",value:function(){var d=this;console.log("network fetching");var e={networkActive:!0};0==this.state.items.length&&(e.isLoading=!0),this.setState(e),setTimeout(function(){var l=d.state.category?d.state.category.txid:get_root_category_txid();fetch_from_network(l).then(function(o){var c=processOpenDirectoryTransactions(o),e=c.filter(function(e){return"entry"==e.type}).map(function(e){var t=e.change.link;return parseTransactionAddressFromURL(t)}).filter(function(e){return e});fetch_bmedia_from_network(e).then(function(e){var t=processOpenDirectoryTransactions(e),a=c.concat(t),n=processResults(o,a),s=d.checkForUpdatedActiveCategory(n),i=d.state.raw;i[l]=o;var r=d.state.cache;r[l]=n,d.setState({networkActive:!1,isLoading:!1,isError:!s,txpool:a,items:n,raw:i,cache:r}),d.setupNetworkSocket()})}).catch(function(e){console.log("error",e),d.setState({isLoading:!1,networkActive:!1,isError:!0})})},this.NETWORK_DELAY)}},{key:"checkForUpdatedActiveCategory",value:function(e){if(this.state.category&&this.state.category.txid&&this.state.category.needsdata){var t=!0,a=!1,n=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var r=s.value;if("category"==r.type&&r.txid==this.state.category.txid)return this.setState({category:r}),document.title=r.name+" — "+this.state.title,!0}}catch(e){a=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}return!1}return!0}},{key:"setupNetworkSocket",value:function(){var s=this;this.socket?(console.log("refreshing network socket"),this.socket.close(),delete this.socket):console.log("setting up new network socket");var e=get_bitdb_query(this.state.category?this.state.category.txid:get_root_category_txid()),t=toBase64(JSON.stringify(e)),a=SETTINGS.api_endpoint.replace("{api_key}",SETTINGS.api_key).replace("{api_action}","s").replace("{query}",t);this.socket=new EventSource(a),this.socket.onmessage=function(e){try{var t=JSON.parse(e.data);if(("c"==t.type||"u"==t.type)&&0<t.data.length){for(var a=!1,n=0;n<t.data.length;n++)t.data[n]&&t.data[n].data&&t.data[n].data.s1==OPENDIR_PROTOCOL&&(a=!0);a?(console.log("handled new message",t),s.networkAPIFetch()):console.log("unhandled message",t)}}catch(e){console.log("error handling network socket data",e.data)}}}}]),a}(),MessageGroup=posed.div({enter:{applyAtStart:{display:"block"},opacity:1,beforeChildren:!0},exit:{applyAtEnd:{display:"none"},opacity:0,beforeChildren:!0}}),Message=posed.div({}),application=React.createElement(OpenDirectoryApp,null);ReactDOM.render(application,document.getElementById("app"));